<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ•°å­—åŒ–å­ªç”Ÿå¤§æ£š</title>
<!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
<!-- Tailwind é…ç½® -->
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#2E7D32', // ä¸»è‰²è°ƒï¼šæ·±ç»¿è‰²
        secondary: '#039BE5', // è¾…åŠ©è‰²ï¼šè“è‰²
        accent: '#FFB300', // å¼ºè°ƒè‰²ï¼šæ©™è‰²
        neutral: '#F5F5F5', // ä¸­æ€§è‰²ï¼šæµ…ç°
        'neutral-dark': '#263238', // æ·±è‰²æ–‡æœ¬
        'brown': {
          100: '#efebe9',
          500: '#795548',
          600: '#6d4c41',
        }
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
    },
  }
}
</script>
<!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
<style type="text/tailwindcss">
/* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
@layer utilities {
  .content-auto {
    content-visibility: auto;
  }
  .card-shadow {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }
  .sensor-pulse {
    animation: pulse 2s infinite;
  }
  .slide-in {
    animation: slideIn 0.5s ease-out forwards;
  }
  .data-update {
    animation: dataUpdate 0.5s ease-out;
  }
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.8; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes slideIn {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes dataUpdate {
  0% { background-color: rgba(46, 125, 50, 0.2); }
  100% { background-color: transparent; }
}

/* å¤©æ°”ç‰ˆå—æ ·å¼ */
.weather-card {
  background: white;
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
  overflow: hidden;
}
.weather-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: linear-gradient(90deg, #3498db, #2ecc71);
}
.weather-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}
.weather-icon {
  font-size: 3rem;
  margin-bottom: 10px;
  color: #3498db;
}
.weather-temp {
  font-size: 2.5rem;
  font-weight: bold;
  color: #333;
  margin: 10px 0;
}
.weather-desc {
  font-size: 1.1rem;
  color: #666;
  margin-bottom: 15px;
}
.weather-details {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 20px;
}
.weather-detail-item {
  display: flex;
  align-items: center;
}
.weather-detail-icon {
  font-size: 1.2rem;
  color: #3498db;
  margin-right: 10px;
  width: 25px;
}
.weather-detail-label {
  font-size: 0.9rem;
  color: #777;
  margin-bottom: 3px;
}
.weather-detail-value {
  font-size: 1rem;
  font-weight: 600;
  color: #333;
}
.forecast-container {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 15px;
  margin-top: 20px;
}
.forecast-day {
  text-align: center;
  padding: 15px 10px;
  border-radius: 10px;
  background: rgba(52, 152, 219, 0.05);
  transition: background 0.3s ease;
}
.forecast-day:hover {
  background: rgba(52, 152, 219, 0.1);
}
.forecast-date {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 5px;
}
.forecast-icon {
  font-size: 1.8rem;
  margin: 10px 0;
  color: #3498db;
}
.forecast-temp {
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
}
.forecast-desc {
  font-size: 0.8rem;
  color: #777;
  margin-top: 5px;
}
.aqi-indicator {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
  margin-top: 5px;
}
.aqi-good {
  background: rgba(46, 204, 113, 0.1);
  color: #2ecc71;
}
.aqi-moderate {
  background: rgba(241, 196, 15, 0.1);
  color: #f1c40f;
}
.aqi-unhealthy {
  background: rgba(230, 126, 34, 0.1);
  color: #e67e22;
}
.aqi-very-unhealthy {
  background: rgba(231, 76, 60, 0.1);
  color: #e74c3c;
}
.aqi-hazardous {
  background: rgba(142, 68, 173, 0.1);
  color: #8e44ad;
}

/* å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
.sensor-card {
  background: rgba(255, 255, 255, 0.9);
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.sensor-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: linear-gradient(90deg, #2E7D32, #4CAF50);
}
.sensor-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}
.sensor-card:hover .card-icon {
  transform: scale(1.1);
}
.card-icon {
  font-size: 3rem;
  margin-bottom: 15px;
  color: #1a2a6c;
  transition: transform 0.3s ease;
}
.card-title {
  font-size: 1.3rem;
  margin-bottom: 10px;
  color: #1a2a6c;
}
.card-value {
  font-size: 2.2rem;
  font-weight: bold;
  margin: 10px 0;
  color: #b21f1f;
  transition: all 0.5s ease;
}
.card-unit {
  font-size: 1.1rem;
  color: #666;
  margin-left: 5px;
}
.card-time {
  font-size: 0.8rem;
  color: #888;
  margin-top: 8px;
}
.loading {
  display: none;
  text-align: center;
  margin: 20px 0;
  color: #333;
}
.spinner {
  border: 5px solid rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  border-top: 5px solid #2E7D32;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.error {
  color: #ff4d4d;
  text-align: center;
  margin: 10px 0;
  padding: 10px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 10px;
  display: none;
}

/* ç¯å¢ƒç›‘æµ‹å¡ç‰‡æ–°æ ·å¼ */
.env-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  border-left: 4px solid #2E7D32;
  position: relative;
  overflow: hidden;
}
.env-card::after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 30px 30px 0;
  border-color: transparent rgba(46, 125, 50, 0.1) transparent transparent;
}
.env-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
}
.env-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}
.env-card-icon {
  font-size: 1.8rem;
  color: #2E7D32;
  background: rgba(46, 125, 50, 0.1);
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s ease;
}
.env-card:hover .env-card-icon {
  transform: rotate(10deg) scale(1.1);
}
.env-card-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #263238;
  margin-bottom: 5px;
}
.env-card-subtitle {
  font-size: 0.85rem;
  color: #666;
}
.env-card-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #2E7D32;
  margin: 10px 0;
  transition: all 0.5s ease;
}
.env-card-status {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
  transition: all 0.3s ease;
}
.status-good {
  background: rgba(76, 175, 80, 0.1);
  color: #4CAF50;
}
.status-warning {
  background: rgba(255, 152, 0, 0.1);
  color: #FF9800;
}
.status-critical {
  background: rgba(244, 67, 54, 0.1);
  color: #F44336;
}

/* æ–°å¢äº¤äº’æ ·å¼ */
.nav-link {
  position: relative;
  padding: 8px 0;
}
.nav-link::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 2px;
  background-color: #2E7D32;
  transition: width 0.3s ease;
}
.nav-link:hover::after {
  width: 100%;
}
.nav-link.active::after {
  width: 100%;
}
.chart-tooltip {
  position: absolute;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 14px;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s;
  z-index: 100;
}
.refresh-animation {
  animation: refreshSpin 0.5s ease;
}
@keyframes refreshSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.notification-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #FF5722;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: pulse 1.5s infinite;
}
.progress-ring {
  position: relative;
  width: 60px;
  height: 60px;
}
.progress-ring-circle {
  transform: rotate(-90deg);
  transform-origin: 50% 50%;
}
.progress-ring-bg {
  fill: none;
  stroke: #e6e6e6;
  stroke-width: 4;
}
.progress-ring-fill {
  fill: none;
  stroke: #2E7D32;
  stroke-width: 4;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.5s ease;
}
.progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 14px;
  font-weight: bold;
  color: #2E7D32;
}
.data-card {
  transition: all 0.3s ease;
  cursor: pointer;
}
.data-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}
.data-card.expanded {
  grid-column: 1 / -1;
}

/* ç§æ¤å»ºè®®æ¨¡å—æ ·å¼ */
.crop-type-btn {
  padding: 10px 8px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  background: white;
  color: #374151;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}
.crop-type-btn:hover {
  border-color: #2E7D32;
  color: #2E7D32;
}
.crop-type-btn.active {
  border-color: #2E7D32;
  background: #2E7D32;
  color: white;
}
.growth-stage-btn {
  padding: 8px 4px;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  background: #f9fafb;
  color: #6b7280;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
}
.growth-stage-btn:hover {
  border-color: #2E7D32;
  color: #2E7D32;
}
.growth-stage-btn.active {
  border-color: #2E7D32;
  background: #2E7D32;
  color: white;
}
.planting-day {
  padding: 8px 4px;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  background: white;
  text-align: center;
  font-size: 0.8rem;
}
.planting-day.today {
  border-color: #2E7D32;
  background: rgba(46, 125, 50, 0.1);
  font-weight: 600;
}
.planting-day.task {
  border-color: #FFB300;
  background: rgba(255, 179, 0, 0.1);
}

/* AIåŠ©æ‰‹æ ·å¼ */
.ai-assistant-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
}

.ai-assistant-button {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, #2E7D32, #4CAF50);
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
  transition: all 0.3s ease;
}

.ai-assistant-button:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
}

.ai-assistant-button.active {
  background: linear-gradient(135deg, #1976D2, #2196F3);
}

.ai-chat-window {
  position: absolute;
  bottom: 70px;
  right: 0;
  width: 350px;
  height: 500px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transform: scale(0.8);
  opacity: 0;
  transform-origin: bottom right;
  transition: all 0.3s ease;
  pointer-events: none;
}

.ai-chat-window.active {
  transform: scale(1);
  opacity: 1;
  pointer-events: all;
}

.ai-chat-header {
  background: linear-gradient(135deg, #2E7D32, #4CAF50);
  color: white;
  padding: 15px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.ai-chat-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}

.ai-chat-close {
  background: none;
  border: none;
  color: white;
  font-size: 18px;
  cursor: pointer;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease;
}

.ai-chat-close:hover {
  background: rgba(255, 255, 255, 0.1);
}

.ai-chat-messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  background: #f8f9fa;
}

.ai-message {
  margin-bottom: 15px;
  display: flex;
  flex-direction: column;
}

.ai-message.user {
  align-items: flex-end;
}

.ai-message.bot {
  align-items: flex-start;
}

.message-bubble {
  max-width: 80%;
  padding: 10px 15px;
  border-radius: 18px;
  word-wrap: break-word;
}

.user .message-bubble {
  background: #2E7D32;
  color: white;
  border-bottom-right-radius: 5px;
}

.bot .message-bubble {
  background: white;
  color: #333;
  border: 1px solid #e0e0e0;
  border-bottom-left-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.message-time {
  font-size: 11px;
  color: #999;
  margin-top: 5px;
}

.ai-chat-input {
  padding: 15px 20px;
  border-top: 1px solid #e0e0e0;
  background: white;
  display: flex;
  align-items: center;
}

.ai-chat-input input {
  flex: 1;
  padding: 10px 15px;
  border: 1px solid #e0e0e0;
  border-radius: 25px;
  outline: none;
  font-size: 14px;
  transition: border 0.3s ease;
}

.ai-chat-input input:focus {
  border-color: #2E7D32;
}

.ai-chat-input button {
  margin-left: 10px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #2E7D32;
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.3s ease;
}

.ai-chat-input button:hover {
  background: #1B5E20;
}

.ai-loading {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  background: white;
  border-radius: 18px;
  border: 1px solid #e0e0e0;
  margin-bottom: 15px;
}

.ai-loading-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #2E7D32;
  margin: 0 3px;
  animation: loadingDot 1.4s infinite ease-in-out both;
}

.ai-loading-dot:nth-child(1) {
  animation-delay: -0.32s;
}

.ai-loading-dot:nth-child(2) {
  animation-delay: -0.16s;
}

@keyframes loadingDot {
  0%, 80%, 100% { 
    transform: scale(0);
  } 
  40% { 
    transform: scale(1.0);
  }
}

.quick-questions {
  padding: 10px 20px;
  background: #f1f8e9;
  border-top: 1px solid #e0e0e0;
}

.quick-questions h4 {
  margin: 0 0 10px 0;
  font-size: 14px;
  color: #2E7D32;
  font-weight: 600;
}

.quick-question-btn {
  display: inline-block;
  background: white;
  border: 1px solid #c8e6c9;
  color: #2E7D32;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  margin-right: 8px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.quick-question-btn:hover {
  background: #2E7D32;
  color: white;
}
</style>
</head>
<body class="bg-gray-50 font-sans text-neutral-dark">

<!-- AIåŠ©æ‰‹ - æ›¿æ¢å¤–éƒ¨è„šæœ¬ -->
<div class="ai-assistant-container">
  <button class="ai-assistant-button" id="aiAssistantButton">
    <i class="fa fa-leaf"></i>
  </button>
  
  <div class="ai-chat-window" id="aiChatWindow">
    <div class="ai-chat-header">
      <h3>AIå†œä¸šå°åŠ©æ‰‹</h3>
      <button class="ai-chat-close" id="aiChatClose">
        <i class="fa fa-times"></i>
      </button>
    </div>
    
    <div class="ai-chat-messages" id="aiChatMessages">
      <!-- åˆå§‹æ¬¢è¿æ¶ˆæ¯ -->
      <div class="ai-message bot">
        <div class="message-bubble">
          <strong>å˜¿ï¼Œæ–°å†œäººï¼</strong> æˆ‘æ˜¯æ‚¨çš„AIç§ç”°å°å¸®æ‰‹ã€‚<br><br>
          æˆ‘èƒ½é™ªæ‚¨èŠèŠåº„ç¨¼çš„é•¿åŠ¿ï¼Œå¸®æ‚¨çœ‹çœ‹å¶å­å‘é»„æ˜¯å•¥åŸå› ï¼Œä¹Ÿèƒ½ä¸€èµ·ç®—ç®—æ–½è‚¥æ‰“è¯çš„ç»æµè´¦ã€‚<br><br>
          æ‚¨ä»Šå¤©æ˜¯æƒ³èŠèŠ"ç‰ç±³çš„ç—…è™«å®³é˜²æ²»"ï¼Œè¿˜æ˜¯å…³å¿ƒ"å¤§æ£šç•ªèŒ„çš„æ¸©å·®ç®¡ç†"ï¼Ÿæˆ–è€…ç›´æ¥å‘Šè¯‰æˆ‘æ‚¨é‡åˆ°äº†ä»€ä¹ˆæƒ…å†µï¼Œæˆ‘æ¥å¸®æ‚¨å‡ºå‡ºä¸»æ„ï¼
        </div>
        <div class="message-time">2025/12/09 14:36:34</div>
      </div>
      
      <!-- ç¤ºä¾‹é—®é¢˜ -->
      <div class="ai-message user">
        <div class="message-bubble">è¯·ä¸º50äº©æ°´ç¨»ç”°æ¨èä¸€ä¸ªèŠ‚æ°´çŒæº‰æ–¹æ¡ˆ</div>
        <div class="message-time">2025/12/09 14:36:35</div>
      </div>
      
      <div class="ai-message bot">
        <div class="message-bubble">
          <strong>ğŸŒ¾ 50äº©æ°´ç¨»ç”°èŠ‚æ°´çŒæº‰æ–¹æ¡ˆ</strong><br><br>
          
          <strong>1ï¸âƒ£ æ ¸å¿ƒçŒæº‰æ¨¡å¼ï¼š</strong><br>
          â€¢ <strong>æ§åˆ¶çŒæº‰æŠ€æœ¯</strong>ï¼šæ ¹æ®æ°´ç¨»ä¸åŒç”Ÿè‚²æœŸéœ€æ°´ç‰¹ç‚¹ç²¾å‡†ä¾›æ°´<br>
          â€¢ <strong>æµ…æ¹¿çŒæº‰</strong>ï¼šä¿æŒ"æµ…æ°´å±‚-æ¹¿æ¶¦-æµ…æ°´å±‚"äº¤æ›¿ï¼ŒèŠ‚æ°´20-30%<br><br>
          
          <strong>2ï¸âƒ£ åˆ†ç”Ÿè‚²æœŸç®¡ç†ï¼š</strong><br>
          â€¢ <strong>åˆ†è˜–æœŸ</strong>ï¼šæµ…æ°´å‹¤çŒï¼Œä¿æŒç”°é—´æ¹¿æ¶¦<br>
          â€¢ <strong>æ‹”èŠ‚å­•ç©—æœŸ</strong>ï¼šä¿æŒ3-5cmæµ…æ°´å±‚<br>
          â€¢ <strong>æŠ½ç©—æ‰¬èŠ±æœŸ</strong>ï¼šç»´æŒæ°´å±‚ä¿éšœæˆç²‰<br>
          â€¢ <strong>çŒæµ†æˆç†ŸæœŸ</strong>ï¼šå¹²æ¹¿äº¤æ›¿ï¼Œä¿ƒè¿›ç±½ç²’é¥±æ»¡<br><br>
          
          <strong>3ï¸âƒ£ å…³é”®èŠ‚æ°´æªæ–½ï¼š</strong><br>
          â€¢ <strong>ç”°åŸ‚é˜²æ¸—</strong>ï¼šç¡¬åŒ–ç”°åŸ‚æˆ–é“ºè®¾é˜²æ¸—è†œï¼Œå‡å°‘ä¾§æ¸—æŸå¤±<br>
          â€¢ <strong>åˆ†åŒºåˆ†ç‰‡</strong>ï¼šå°†50äº©åˆ’åˆ†ä¸º10-15äº©å°åŒºï¼Œè½®çŒæé«˜æ•ˆç‡<br>
          â€¢ <strong>åœŸå£¤å¢’æƒ…ç›‘æµ‹</strong>ï¼šå®‰è£…æ¹¿åº¦ä¼ æ„Ÿå™¨ï¼Œå®ç°æŒ‰éœ€çŒæº‰<br>
          â€¢ <strong>ç§¸ç§†è¦†ç›–</strong>ï¼šè¡Œé—´è¦†ç›–ç§¸ç§†ï¼Œå‡å°‘è’¸å‘æŸå¤±30%ä»¥ä¸Š<br><br>
          
          <strong>4ï¸âƒ£ é¢„æœŸèŠ‚æ°´æ•ˆæœï¼š</strong><br>
          â€¢ ä¼ ç»Ÿæ¼«çŒï¼šäº©å‡ç”¨æ°´800-1000mÂ³<br>
          â€¢ æœ¬æ–¹æ¡ˆï¼šäº©å‡ç”¨æ°´500-600mÂ³<br>
          â€¢ <strong>50äº©å¹´èŠ‚æ°´ï¼š</strong>çº¦15000-20000mÂ³<br><br>
          
          <strong>ğŸ’¡ å®æ–½å»ºè®®ï¼š</strong><br>
          å»ºè®®å…ˆé€‰æ‹©10äº©è¿›è¡Œè¯•ç‚¹ï¼Œå®‰è£…ç®€æ˜“åœŸå£¤æ¹¿åº¦è®¡ï¼Œæ ¹æ®ä½œç‰©éœ€æ°´è§„å¾‹è°ƒæ•´çŒæº‰åˆ¶åº¦ï¼Œé€æ­¥æ¨å¹¿è‡³å…¨ç”°ã€‚
        </div>
        <div class="message-time">2025/12/09 14:36:36</div>
      </div>
    </div>
    
    <div class="quick-questions">
      <h4>å¸¸è§é—®é¢˜å¿«é€Ÿæé—®ï¼š</h4>
      <button class="quick-question-btn" onclick="askQuickQuestion('ç‰ç±³åº•éƒ¨å¶ç‰‡å‡ºç°é»„è¤è‰²æ–‘ç‚¹æ€ä¹ˆåŠï¼Ÿ')">ç‰ç±³é»„æ–‘ç—…</button>
      <button class="quick-question-btn" onclick="askQuickQuestion('å¤§æ£šç•ªèŒ„ç§æ¤ç®¡ç†è®¡åˆ’')">ç•ªèŒ„ç§æ¤è®¡åˆ’</button>
      <button class="quick-question-btn" onclick="askQuickQuestion('æ°´ç¨»èŠ‚æ°´çŒæº‰æ–¹æ¡ˆ')">èŠ‚æ°´çŒæº‰</button>
      <button class="quick-question-btn" onclick="askQuickQuestion('å°éº¦ç—…è™«å®³é˜²æ²»')">å°éº¦é˜²ç—…</button>
    </div>
    
    <div class="ai-chat-input">
      <input type="text" id="aiChatInput" placeholder="è¾“å…¥æ‚¨çš„å†œä¸šé—®é¢˜..." onkeypress="handleAiInputKeypress(event)">
      <button id="aiChatSend">
        <i class="fa fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header class="sticky top-0 z-50 bg-white shadow-md transition-all duration-300" id="mainHeader">
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center space-x-2">
      <i class="fa fa-leaf text-primary text-2xl"></i>
      <h1 class="text-xl md:text-2xl font-bold text-primary">æ•°å­—åŒ–å­ªç”Ÿå¤§æ£š</h1>
    </div>
    <!-- å¯¼èˆªèœå• - æ¡Œé¢ç‰ˆ -->
    <nav class="hidden md:flex items-center space-x-6">
      <a href="#overview" class="nav-link hover:text-primary transition-colors">æ¦‚è§ˆ</a>
      <a href="#outdoor" class="nav-link hover:text-primary transition-colors">æˆ·å¤–ç¯å¢ƒ</a>
      <a href="#weather" class="nav-link hover:text-primary transition-colors">å¤©æ°”ä¿¡æ¯</a>
      <a href="#trends" class="nav-link hover:text-primary transition-colors">ç¯å¢ƒè¶‹åŠ¿</a>
      <a href="#planting-advice" class="nav-link hover:text-primary transition-colors">ç§æ¤å»ºè®®</a>
      <a href="/climate-report" class="nav-link hover:text-primary transition-colors">æ°”å€™åˆ†æ</a>
      <a href="http://172.20.1.102:5000" target="_blank" class="nav-link hover:text-primary transition-colors">ç—…è™«å®³æ£€æµ‹</a>
    </nav>
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <div class="hidden md:flex items-center space-x-4">
      <span id="userWelcome">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
    </div>
    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button id="menuBtn" class="md:hidden text-neutral-dark text-xl">
      <i class="fa fa-bars"></i>
    </button>
  </div>
  <!-- ç§»åŠ¨ç«¯èœå• -->
  <div id="mobileMenu" class="md:hidden hidden bg-white border-t">
    <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
      <a href="#overview" class="py-2 hover:text-primary transition-colors">æ¦‚è§ˆ</a>
      <a href="#outdoor" class="py-2 hover:text-primary transition-colors">æˆ·å¤–ç¯å¢ƒ</a>
      <a href="#weather" class="py-2 hover:text-primary transition-colors">å¤©æ°”ä¿¡æ¯</a>
      <a href="#trends" class="py-2 hover:text-primary transition-colors">ç¯å¢ƒè¶‹åŠ¿</a>
      <a href="#planting-advice" class="py-2 hover:text-primary transition-colors">ç§æ¤å»ºè®®</a>
      <a href="/climate-report" class="py-2 hover:text-primary transition-colors">æ°”å€™åˆ†æ</a>
      <a href="http://172.20.1.102:5000" target="_blank" class="py-2 hover:text-primary transition-colors">ç—…è™«å®³æ£€æµ‹</a>
      <div class="pt-2 border-t">
        <span id="mobileUserWelcome" class="py-2 block">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
      </div>
    </div>
  </div>
</header>

<!-- ä¸»å†…å®¹åŒº -->
<main class="container mx-auto px-4 py-6" id="mainContent">
  <!-- æ¦‚è§ˆé¢æ¿ -->
  <section id="overview" class="mb-8 slide-in" style="animation-delay: 0.1s">
    <div class="bg-gradient-to-r from-primary to-primary/80 rounded-xl p-6 text-white">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
        <div>
          <h2 class="text-2xl font-bold mb-2">å†œä¸šå¤§æ£šå®æ—¶ç›‘æµ‹</h2>
          <p class="opacity-90">å®æ—¶ç›‘æ§å›­åŒºç¯å¢ƒæ•°æ®ï¼Œæ™ºèƒ½åˆ†æå†œä¸šç”Ÿäº§æ¡ä»¶</p>
        </div>
        <div class="mt-4 md:mt-0 flex items-center space-x-4">
          <div class="flex items-center">
            <i class="fa fa-clock-o mr-2"></i>
            <span id="currentTime">åŠ è½½ä¸­...</span>
          </div>
          <div class="flex items-center">
            <i class="fa fa-refresh mr-2"></i>
            <span>ä¸Šæ¬¡æ›´æ–°: <span id="lastUpdate">1åˆ†é’Ÿå‰</span></span>
          </div>
        </div>
      </div>
      <!-- å…³é”®æŒ‡æ ‡å¡ç‰‡ -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 data-card">
          <div class="text-sm opacity-80">å¹³å‡æ¸©åº¦</div>
          <div class="text-2xl font-bold mt-1" id="avg-temp">--Â°C</div>
          <div class="text-xs mt-1 flex items-center">
            <i class="fa fa-arrow-down text-blue-200 mr-1"></i> å®æ—¶æ›´æ–°
          </div>
        </div>
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 data-card">
          <div class="text-sm opacity-80">å¹³å‡æ¹¿åº¦</div>
          <div class="text-2xl font-bold mt-1" id="avg-humidity">--%</div>
          <div class="text-xs mt-1 flex items-center">
            <i class="fa fa-arrow-down text-blue-200 mr-1"></i> å®æ—¶æ›´æ–°
          </div>
        </div>
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 data-card">
          <div class="text-sm opacity-80">åœŸå£¤æ¹¿åº¦</div>
          <div class="text-2xl font-bold mt-1" id="avg-soil-moisture">52 %</div>
          <div class="text-xs mt-1 flex items-center">
            <i class="fa fa-check text-green-200 mr-1"></i> æ¨¡æ‹Ÿæ•°æ®
          </div>
        </div>
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 data-card">
          <div class="text-sm opacity-80">ä¼ æ„Ÿå™¨åœ¨çº¿</div>
          <div class="text-2xl font-bold mt-1" id="online-sensors">3/3</div>
          <div class="text-xs mt-1 flex items-center">
            <i class="fa fa-signal text-green-200 mr-1"></i> å…¨éƒ¨æ­£å¸¸
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- æˆ·å¤–ç¯å¢ƒç›‘æµ‹æ¨¡å— -->
  <section id="outdoor" class="mb-8 slide-in" style="animation-delay: 0.2s">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-neutral-dark">
        <i class="fa fa-tree text-green-600 mr-2"></i>æˆ·å¤–ç¯å¢ƒç›‘æµ‹
      </h2>
      <div class="flex items-center space-x-2">
        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center">
          <i class="fa fa-circle text-xs mr-1 sensor-pulse"></i> å®æ—¶ç›‘æµ‹ä¸­
        </span>
        <button class="text-secondary hover:underline text-sm flex items-center">
          æŸ¥çœ‹è¯¦æƒ… <i class="fa fa-angle-right ml-1"></i>
        </button>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- æ¸©åº¦ä¼ æ„Ÿå™¨ - ä¿®æ”¹ä¸ºå›ºå®šæ¨¡æ‹Ÿæ•°æ® -->
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="font-semibold">ç©ºæ°”æ¸©åº¦</h3>
            <p class="text-sm text-gray-500">ä¼ æ„Ÿå™¨ #OUT-01</p>
          </div>
          <div class="bg-red-100 text-red-600 p-2 rounded-lg">
            <i class="fa fa-thermometer-half"></i>
          </div>
        </div>
        <div class="flex items-end space-x-2 mb-4">
          <div class="text-3xl font-bold" id="outdoor-temp">-1.00Â°C</div>
          <div class="text-sm text-red-600 mb-1">
            <i class="fa fa-arrow-down"></i> æ¨¡æ‹Ÿæ•°æ®
          </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
          <div class="bg-red-500 h-2.5 rounded-full" style="width: 15%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>-10Â°C</span>
          <span>é€‚å®œ: 15-20Â°C</span>
          <span>30Â°C</span>
        </div>
      </div>
      <!-- æ¹¿åº¦ä¼ æ„Ÿå™¨ - ä¿®æ”¹ä¸ºå›ºå®šæ¨¡æ‹Ÿæ•°æ® -->
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="font-semibold">ç©ºæ°”æ¹¿åº¦</h3>
            <p class="text-sm text-gray-500">ä¼ æ„Ÿå™¨ #OUT-02</p>
          </div>
          <div class="bg-blue-100 text-blue-600 p-2 rounded-lg">
            <i class="fa fa-tint"></i>
          </div>
        </div>
        <div class="flex items-end space-x-2 mb-4">
          <div class="text-3xl font-bold" id="outdoor-humidity">52.16%</div>
          <div class="text-sm text-red-600 mb-1">
            <i class="fa fa-arrow-down"></i> æ¨¡æ‹Ÿæ•°æ®
          </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
          <div class="bg-blue-500 h-2.5 rounded-full" style="width: 52.16%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>0%</span>
          <span>é€‚å®œ: 60-70%</span>
          <span>100%</span>
        </div>
      </div>
      <!-- åœŸå£¤æ¹¿åº¦ä¼ æ„Ÿå™¨ -->
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="font-semibold">åœŸå£¤æ¹¿åº¦</h3>
            <p class="text-sm text-gray-500">ä¼ æ„Ÿå™¨ #OUT-03</p>
          </div>
          <div class="bg-brown-100 text-brown-600 p-2 rounded-lg">
            <i class="fa fa-tint"></i>
          </div>
        </div>
        <div class="flex items-end space-x-2 mb-4">
          <div class="text-3xl font-bold" id="outdoor-soil-moisture">52 %</div>
          <div class="text-sm text-red-600 mb-1">
            <i class="fa fa-arrow-down"></i> æ¨¡æ‹Ÿæ•°æ®
          </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
          <div class="bg-brown-500 h-2.5 rounded-full" style="width: 58%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>0%</span>
          <span>é€‚å®œ: 40-60%</span>
          <span>100%</span>
        </div>
      </div>
      <!-- CO2ä¼ æ„Ÿå™¨ -->
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="font-semibold">COâ‚‚æµ“åº¦</h3>
            <p class="text-sm text-gray-500">ä¼ æ„Ÿå™¨ #OUT-04</p>
          </div>
          <div class="bg-purple-100 text-purple-600 p-2 rounded-lg">
            <i class="fa fa-dashboard"></i>
          </div>
        </div>
        <div class="flex items-end space-x-2 mb-4">
          <div class="text-3xl font-bold" id="outdoor-co2">426 ppm</div>
          <div class="text-sm text-gray-500 mb-1">
            <i class="fa fa-minus"></i> 0 ppm
          </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
          <div class="bg-purple-500 h-2.5 rounded-full" style="width: 43%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>0 ppm</span>
          <span>é€‚å®œ: <450 ppm</span>
          <span>1000 ppm</span>
        </div>
      </div>
    </div>
  </section>

  <!-- å¤©æ°”ä¿¡æ¯æ¨¡å— -->
  <section id="weather" class="mb-8 slide-in" style="animation-delay: 0.3s">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-neutral-dark">
        <i class="fa fa-cloud text-blue-500 mr-2"></i>å¤©æ°”ä¿¡æ¯
      </h2>
      <div class="flex items-center space-x-2">
        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center">
          <i class="fa fa-refresh text-xs mr-1"></i> å®æ—¶æ›´æ–°ä¸­
        </span>
        <button class="text-secondary hover:underline text-sm flex items-center" id="refresh-weather-btn">
          <i class="fa fa-refresh mr-1"></i> åˆ·æ–°å¤©æ°”
        </button>
      </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- å½“å‰å¤©æ°”å¡ç‰‡ -->
      <div class="weather-card lg:col-span-2">
        <div class="flex flex-col md:flex-row items-center justify-between">
          <div class="text-center md:text-left">
            <div class="flex items-center justify-center md:justify-start">
              <i class="fa fa-map-marker mr-2 text-gray-500"></i>
              <h3 class="text-lg font-semibold">å½“å‰åœ°åŒºï¼šå±±ä¸œçœæµå—å¸‚</h3>
            </div>
            <div class="weather-temp" id="current-temp">-1Â°C</div>
            <div class="weather-desc" id="weather-desc">å°é›ª</div>
            <div class="text-sm text-gray-500" id="update-time">æ›´æ–°æ—¶é—´: åˆšåˆš</div>
          </div>
          <div class="text-center mt-4 md:mt-0">
            <i class="fa fa-snowflake-o weather-icon" id="weather-icon"></i>
          </div>
        </div>
        <div class="weather-details">
          <div class="weather-detail-item">
            <div class="weather-detail-icon">
              <i class="fa fa-tint"></i>
            </div>
            <div>
              <div class="weather-detail-label">æ¹¿åº¦</div>
              <div class="weather-detail-value" id="current-humidity">85%</div>
            </div>
          </div>
          <div class="weather-detail-item">
            <div class="weather-detail-icon">
              <i class="fa fa-wind"></i>
            </div>
            <div>
              <div class="weather-detail-label">é£é€Ÿ</div>
              <div class="weather-detail-value" id="current-wind">8 km/h</div>
            </div>
          </div>
          <div class="weather-detail-item">
            <div class="weather-detail-icon">
              <i class="fa fa-compass"></i>
            </div>
            <div>
              <div class="weather-detail-label">é£å‘</div>
              <div class="weather-detail-value" id="current-wind-dir">åŒ—é£</div>
            </div>
          </div>
          <div class="weather-detail-item">
            <div class="weather-detail-icon">
              <i class="fa fa-thermometer"></i>
            </div>
            <div>
              <div class="weather-detail-label">ä½“æ„Ÿæ¸©åº¦</div>
              <div class="weather-detail-value" id="current-feels-like">-3Â°C</div>
            </div>
          </div>
          <div class="weather-detail-item">
            <div class="weather-detail-icon">
              <i class="fa fa-sun-o"></i>
            </div>
            <div>
              <div class="weather-detail-label">ç´«å¤–çº¿æŒ‡æ•°</div>
              <div class="weather-detail-value" id="current-uv">1 å¼±</div>
            </div>
          </div>
          <div class="weather-detail-item">
            <div class="weather-detail-icon">
              <i class="fa fa-eye"></i>
            </div>
            <div>
              <div class="weather-detail-label">èƒ½è§åº¦</div>
              <div class="weather-detail-value" id="current-visibility">8 km</div>
            </div>
          </div>
        </div>
      </div>
      <!-- å¤©æ°”ä¿¡æ¯å¡ç‰‡ -->
      <div class="weather-card">
        <h3 class="text-lg font-semibold mb-4">å¤©æ°”ä¿¡æ¯</h3>
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <div class="text-gray-600">æ—¥å‡º/æ—¥è½</div>
            <div class="font-medium" id="sunrise-sunset">07:15 / 16:58</div>
          </div>
          <div class="flex justify-between items-center">
            <div class="text-gray-600">é™æ°´æ¦‚ç‡</div>
            <div class="font-medium" id="precipitation">85%</div>
          </div>
          <div class="flex justify-between items-center">
            <div class="text-gray-600">æ°”å‹</div>
            <div class="font-medium" id="pressure">1018 hPa</div>
          </div>
          <div class="flex justify-between items-center">
            <div class="text-gray-600">ç©ºæ°”è´¨é‡</div>
            <div>
              <span class="font-medium" id="aqi-value">35</span>
              <span class="aqi-indicator aqi-good" id="aqi-level">ä¼˜</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <div class="text-gray-600">éœ²ç‚¹</div>
            <div class="font-medium" id="dew-point">-4Â°C</div>
          </div>
          <div class="flex justify-between items-center">
            <div class="text-gray-600">äº‘é‡</div>
            <div class="font-medium" id="cloud-cover">90%</div>
          </div>
        </div>
      </div>
    </div>
    <!-- å¤©æ°”é¢„æŠ¥ -->
    <div class="mt-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">æœªæ¥å¤©æ°”é¢„æŠ¥</h3>
        <div class="text-sm text-gray-500" id="forecast-update-time">ä¸‹æ¬¡æ›´æ–°: 30åˆ†é’Ÿå</div>
      </div>
      <div class="forecast-container" id="forecast-container">
        <!-- å¤©æ°”é¢„æŠ¥å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </section>

  <!-- ç¯å¢ƒè¶‹åŠ¿æ¨¡å— -->
  <section id="trends" class="mb-8 slide-in" style="animation-delay: 0.4s">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-neutral-dark">
        <i class="fa fa-line-chart text-secondary mr-2"></i>ç¯å¢ƒè¶‹åŠ¿åˆ†æ
      </h2>
      <div class="flex space-x-2">
        <button class="bg-primary text-white px-3 py-1 rounded-md text-sm" onclick="changeTimeRange('day')">æ—¥</button>
        <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-md text-sm transition-colors" onclick="changeTimeRange('week')">å‘¨</button>
        <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-md text-sm transition-colors" onclick="changeTimeRange('month')">æœˆ</button>
        <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-md text-sm transition-colors" onclick="changeTimeRange('year')">å¹´</button>
      </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- æ¸©åº¦æ¹¿åº¦è¶‹åŠ¿å›¾ -->
      <div class="bg-white rounded-xl p-5 card-shadow">
        <h3 class="font-semibold mb-4">æ¸©åº¦ä¸æ¹¿åº¦è¶‹åŠ¿</h3>
        <div class="h-64 relative">
          <canvas id="tempHumidityChart"></canvas>
          <div class="chart-tooltip" id="tempHumidityTooltip"></div>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
            <span>æ¸©åº¦ (Â°C)</span>
          </div>
          <div class="flex items-center">
            <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
            <span>æ¹¿åº¦ (%)</span>
          </div>
        </div>
      </div>
      <!-- å…‰ç…§è¶‹åŠ¿å›¾ -->
      <div class="bg-white rounded-xl p-5 card-shadow">
        <h3 class="font-semibold mb-4">å…‰ç…§å¼ºåº¦è¶‹åŠ¿</h3>
        <div class="h-64 relative">
          <canvas id="lightChart"></canvas>
          <div class="chart-tooltip" id="lightTooltip"></div>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
            <span>å…‰ç…§å¼ºåº¦ (åƒlx)</span>
          </div>
        </div>
      </div>
    </div>
    <!-- ç¯å¢ƒæ•°æ®ç»Ÿè®¡ -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">æ¸©åº¦ç»Ÿè®¡</h3>
          <i class="fa fa-thermometer-half text-red-500"></i>
        </div>
        <div class="mt-4 space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-500">æœ€é«˜æ¸©åº¦</span>
            <span class="font-medium" id="max-temp">--Â°C</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">æœ€ä½æ¸©åº¦</span>
            <span class="font-medium" id="min-temp">--Â°C</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">å¹³å‡æ¸©åº¦</span>
            <span class="font-medium" id="avg-temp-stat">--Â°C</span>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">æ¹¿åº¦ç»Ÿè®¡</h3>
          <i class="fa fa-tint text-blue-500"></i>
        </div>
        <div class="mt-4 space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-500">æœ€é«˜æ¹¿åº¦</span>
            <span class="font-medium" id="max-humidity">--%</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">æœ€ä½æ¹¿åº¦</span>
            <span class="font-medium" id="min-humidity">--%</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">å¹³å‡æ¹¿åº¦</span>
            <span class="font-medium" id="avg-humidity-stat">--%</span>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-5 card-shadow data-card">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">å…‰ç…§ç»Ÿè®¡</h3>
          <i class="fa fa-sun-o text-yellow-500"></i>
        </div>
        <div class="mt-4 space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-500">æœ€é«˜å¼ºåº¦</span>
            <span class="font-medium" id="max-light">-- lx</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">æœ€ä½å¼ºåº¦</span>
            <span class="font-medium" id="min-light">-- lx</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">å¹³å‡å¼ºåº¦</span>
            <span class="font-medium" id="avg-light-stat">-- lx</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- æ™ºèƒ½ç§æ¤å»ºè®®æ¨¡å— -->
  <section id="planting-advice" class="mb-8 slide-in" style="animation-delay: 0.5s">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-neutral-dark">
        <i class="fa fa-leaf text-green-600 mr-2"></i>æ™ºèƒ½ç§æ¤å»ºè®®
      </h2>
      <div class="flex items-center space-x-2">
        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center">
          <i class="fa fa-lightbulb-o text-xs mr-1"></i> AI æ¨è
        </span>
        <button class="text-secondary hover:underline text-sm flex items-center" onclick="refreshPlantingAdvice()">
          <i class="fa fa-refresh mr-1"></i> é‡æ–°åˆ†æ
        </button>
      </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- ä½œç‰©é€‰æ‹©åŒº -->
      <div class="bg-white rounded-xl p-5 card-shadow">
        <h3 class="font-semibold mb-4">ä½œç‰©é€‰æ‹©ä¸é…ç½®</h3>
        
        <div class="space-y-4">
          <!-- ä½œç‰©ç±»å‹é€‰æ‹© -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©ä½œç‰©ç±»å‹</label>
            <div class="grid grid-cols-2 gap-2">
              <button class="crop-type-btn active" data-crop="tomato" onclick="selectCropType('tomato')">
                <i class="fa fa-apple mr-2"></i>ç•ªèŒ„
              </button>
              <button class="crop-type-btn" data-crop="cucumber" onclick="selectCropType('cucumber')">
                <i class="fa fa-cutlery mr-2"></i>é»„ç“œ
              </button>
              <button class="crop-type-btn" data-crop="lettuce" onclick="selectCropType('lettuce')">
                <i class="fa fa-leaf mr-2"></i>ç”Ÿèœ
              </button>
              <button class="crop-type-btn" data-crop="strawberry" onclick="selectCropType('strawberry')">
                <i class="fa fa-apple mr-2"></i>è‰è“
              </button>
              <button class="crop-type-btn" data-crop="pepper" onclick="selectCropType('pepper')">
                <i class="fa fa-fire mr-2"></i>è¾£æ¤’
              </button>
              <button class="crop-type-btn" data-crop="custom" onclick="selectCropType('custom')">
                <i class="fa fa-edit mr-2"></i>è‡ªå®šä¹‰
              </button>
            </div>
          </div>
          
          <!-- è‡ªå®šä¹‰ä½œç‰©å‚æ•° -->
          <div id="custom-crop-form" class="hidden space-y-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ä½œç‰©åç§°</label>
              <input type="text" id="crop-name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é€‚å®œæ¸©åº¦(Â°C)</label>
                <input type="text" id="optimal-temp" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="15-25">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é€‚å®œæ¹¿åº¦(%)</label>
                <input type="text" id="optimal-humidity" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="60-70">
              </div>
            </div>
            <button onclick="saveCustomCrop()" class="w-full bg-primary text-white py-2 rounded-lg hover:bg-primary/90 transition-colors">ä¿å­˜é…ç½®</button>
          </div>
          
          <!-- å½“å‰ç”Ÿé•¿é˜¶æ®µ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">å½“å‰ç”Ÿé•¿é˜¶æ®µ</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="growth-stage-btn active" data-stage="seedling" onclick="selectGrowthStage('seedling')">è‚²è‹—æœŸ</button>
              <button class="growth-stage-btn" data-stage="vegetative" onclick="selectGrowthStage('vegetative')">ç”Ÿé•¿æœŸ</button>
              <button class="growth-stage-btn" data-stage="flowering" onclick="selectGrowthStage('flowering')">å¼€èŠ±æœŸ</button>
              <button class="growth-stage-btn" data-stage="fruiting" onclick="selectGrowthStage('fruiting')">ç»“æœæœŸ</button>
            </div>
          </div>
          
          <!-- ç¯å¢ƒæ•°æ®æ¦‚è§ˆ -->
          <div class="pt-4 border-t">
            <h4 class="text-sm font-medium text-gray-700 mb-2">å½“å‰ç¯å¢ƒçŠ¶å†µ</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600">æ¸©åº¦</span>
                <span class="font-medium" id="current-env-temp">--Â°C</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">æ¹¿åº¦</span>
                <span class="font-medium" id="current-env-humidity">--%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">åœŸå£¤æ¹¿åº¦</span>
                <span class="font-medium" id="current-env-soil">--%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">å…‰ç…§</span>
                <span class="font-medium" id="current-env-light">-- lx</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ç§æ¤å»ºè®®ä¸»é¢æ¿ -->
      <div class="bg-white rounded-xl p-5 card-shadow lg:col-span-2">
        <h3 class="font-semibold mb-4">æ™ºèƒ½ç§æ¤å»ºè®®</h3>
        
        <!-- ç¯å¢ƒé€‚å®œåº¦è¯„ä¼° -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <h4 class="text-md font-medium">ç¯å¢ƒé€‚å®œåº¦è¯„ä¼°</h4>
            <span class="text-sm px-3 py-1 rounded-full bg-green-100 text-green-800" id="suitability-score">--%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
            <div class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-4 rounded-full" id="suitability-bar" style="width: 0%"></div>
          </div>
          <div class="flex justify-between text-xs text-gray-500">
            <span>ä¸é€‚å®œ</span>
            <span>ä¸€èˆ¬</span>
            <span>é€‚å®œ</span>
          </div>
        </div>
        
        <!-- è¯¦ç»†å»ºè®® -->
        <div class="space-y-4">
          <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
            <div class="flex items-start">
              <i class="fa fa-thermometer-half text-blue-500 mt-1 mr-3"></i>
              <div>
                <h5 class="font-medium mb-1">æ¸©åº¦ç®¡ç†å»ºè®®</h5>
                <p class="text-sm text-gray-700" id="temp-advice">åˆ†æä¸­...</p>
              </div>
            </div>
          </div>
          
          <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
            <div class="flex items-start">
              <i class="fa fa-tint text-green-500 mt-1 mr-3"></i>
              <div>
                <h5 class="font-medium mb-1">æ°´åˆ†ç®¡ç†å»ºè®®</h5>
                <p class="text-sm text-gray-700" id="water-advice">åˆ†æä¸­...</p>
              </div>
            </div>
          </div>
          
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg">
            <div class="flex items-start">
              <i class="fa fa-sun-o text-yellow-500 mt-1 mr-3"></i>
              <div>
                <h5 class="font-medium mb-1">å…‰ç…§ç®¡ç†å»ºè®®</h5>
                <p class="text-sm text-gray-700" id="light-advice">åˆ†æä¸­...</p>
              </div>
            </div>
          </div>
          
          <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-lg">
            <div class="flex items-start">
              <i class="fa fa-flask text-purple-500 mt-1 mr-3"></i>
              <div>
                <h5 class="font-medium mb-1">æ–½è‚¥ä¸ç—…è™«å®³é¢„é˜²</h5>
                <p class="text-sm text-gray-700" id="fertilizer-advice">åˆ†æä¸­...</p>
              </div>
            </div>
          </div>
          
          <!-- é¢„è­¦ä¿¡æ¯ -->
          <div id="warning-alert" class="hidden bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
            <div class="flex items-start">
              <i class="fa fa-exclamation-triangle text-red-500 mt-1 mr-3"></i>
              <div>
                <h5 class="font-medium mb-1 text-red-700">é¢„è­¦æç¤º</h5>
                <p class="text-sm text-red-600" id="warning-message"></p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ç§æ¤è®¡åˆ’ -->
        <div class="mt-6 pt-6 border-t">
          <h4 class="text-md font-medium mb-3">æœ¬å‘¨ç§æ¤è®¡åˆ’</h4>
          <div class="grid grid-cols-7 gap-2" id="planting-schedule">
            <!-- å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ç¯å¢ƒç›‘æµ‹æ¨¡å— (å®¤å†…/å¤§æ£š) -->
  <section id="indoor" class="mb-8 slide-in" style="animation-delay: 0.6s">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-neutral-dark">
        <i class="fa fa-area-chart text-primary mr-2"></i>å¤§æ£šç¯å¢ƒç›‘æµ‹
      </h2>
      <div class="flex items-center space-x-2">
        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center">
          <i class="fa fa-circle text-xs mr-1 sensor-pulse"></i> å®æ—¶ç›‘æµ‹ä¸­
        </span>
        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center" id="auto-refresh-status">
          <i class="fa fa-clock-o text-xs mr-1"></i> è‡ªåŠ¨åˆ·æ–°: å¼€å¯
        </span>
        <button class="text-secondary hover:underline text-sm flex items-center" id="refresh-sensor-btn">
          <i class="fa fa-refresh mr-1"></i> åˆ·æ–°æ•°æ®
        </button>
      </div>
    </div>
    <!-- ä¼ æ„Ÿå™¨æ•°æ®åŠ è½½çŠ¶æ€ -->
    <div class="loading" id="sensor-loading">
      <div class="spinner"></div>
      <p>æ­£åœ¨è·å–ä¼ æ„Ÿå™¨æ•°æ®...</p>
    </div>
    <div class="error" id="sensor-error"></div>
    <!-- ä¼ æ„Ÿå™¨æ•°æ®å±•ç¤º - ä¼˜åŒ–ç‰ˆ -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="sensor-dashboard">
      <!-- å…‰ç…§ä¼ æ„Ÿå™¨å¡ç‰‡ -->
      <div class="env-card">
        <div class="env-card-header">
          <div>
            <div class="env-card-title">å…‰ç…§ä¼ æ„Ÿå™¨</div>
            <div class="env-card-subtitle">#SENSOR-LIGHT-01</div>
          </div>
          <div class="env-card-icon">
            <i class="fa fa-sun-o"></i>
          </div>
        </div>
        <div class="env-card-value" id="light-value">--</div>
        <div class="flex justify-between items-center">
          <span class="text-gray-500">å•ä½: lx</span>
          <span class="env-card-status status-good" id="light-status">æ­£å¸¸</span>
        </div>
      </div>
      <!-- æ¸©åº¦ä¼ æ„Ÿå™¨å¡ç‰‡ -->
      <div class="env-card">
        <div class="env-card-header">
          <div>
            <div class="env-card-title">æ¸©åº¦ä¼ æ„Ÿå™¨</div>
            <div class="env-card-subtitle">#SENSOR-TEMP-01</div>
          </div>
          <div class="env-card-icon">
            <i class="fa fa-thermometer-half"></i>
          </div>
        </div>
        <div class="env-card-value" id="temp-value">--</div>
        <div class="flex justify-between items-center">
          <span class="text-gray-500">å•ä½: Â°C</span>
          <span class="env-card-status status-good" id="temp-status">æ­£å¸¸</span>
        </div>
      </div>
      <!-- æ¹¿åº¦ä¼ æ„Ÿå™¨å¡ç‰‡ -->
      <div class="env-card">
        <div class="env-card-header">
          <div>
            <div class="env-card-title">æ¹¿åº¦ä¼ æ„Ÿå™¨</div>
            <div class="env-card-subtitle">#SENSOR-HUM-01</div>
          </div>
          <div class="env-card-icon">
            <i class="fa fa-tint"></i>
          </div>
        </div>
        <div class="env-card-value" id="humidity-value">--</div>
        <div class="flex justify-between items-center">
          <span class="text-gray-500">å•ä½: %</span>
          <span class="env-card-status status-good" id="humidity-status">æ­£å¸¸</span>
        </div>
      </div>
    </div>
    
    <!-- ä¼ æ„Ÿå™¨çŠ¶æ€æ¦‚è§ˆ -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="bg-white rounded-xl p-5 card-shadow">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">ä¼ æ„Ÿå™¨çŠ¶æ€</h3>
          <i class="fa fa-signal text-green-500"></i>
        </div>
        <div class="mt-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-gray-500">åœ¨çº¿ä¼ æ„Ÿå™¨</span>
            <span class="font-medium" id="online-sensors-stat">3/3</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-green-500 h-2 rounded-full" style="width: 100%"></div>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl p-5 card-shadow">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">æ•°æ®æ›´æ–°</h3>
          <i class="fa fa-refresh text-blue-500"></i>
        </div>
        <div class="mt-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-gray-500">æ›´æ–°é¢‘ç‡</span>
            <span class="font-medium">5ç§’</span>
          </div>
          <div class="text-sm text-gray-500">æœ€è¿‘æ›´æ–°: <span id="lastSensorUpdate">åˆšåˆš</span></div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl p-5 card-shadow">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">æ•°æ®è´¨é‡</h3>
          <i class="fa fa-check-circle text-green-500"></i>
        </div>
        <div class="mt-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-gray-500">æ•°æ®å®Œæ•´æ€§</span>
            <span class="font-medium" id="data-quality">--%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-green-500 h-2 rounded-full" style="width: 98.5%"></div>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl p-5 card-shadow">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">å‘Šè­¦çŠ¶æ€</h3>
          <i class="fa fa-bell text-yellow-500"></i>
        </div>
        <div class="mt-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-gray-500">å½“å‰å‘Šè­¦</span>
            <span class="font-medium" id="alert-count">0</span>
          </div>
          <div class="text-sm text-green-500" id="alert-message">ç³»ç»Ÿè¿è¡Œæ­£å¸¸</div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- æ°”å€™åˆ†ææŠ¥å‘Šé¡µé¢ -->
<div id="climateReportPage" class="container mx-auto px-4 py-6 hidden">
  <!-- è¿”å›æŒ‰é’® -->
  <div class="mb-6">
    <button onclick="showMainDashboard()" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
      <i class="fa fa-arrow-left mr-2"></i> è¿”å›ä¸»ä»ªè¡¨æ¿
    </button>
  </div>
  
  <!-- åµŒå…¥æ°”å€™åˆ†ææŠ¥å‘Šå†…å®¹ -->
  <div class="bg-white rounded-xl shadow-lg p-6">
    <div class="header text-center mb-8">
      <h1 class="text-3xl font-bold text-primary mb-2">ğŸŒ¤ï¸ å±±ä¸œå„åœ°å¸‚æ°”å€™åˆ†ææŠ¥å‘Š</h1>
      <p class="text-gray-600">å¤§æ£šå†œä½œç‰©å‘è‚²æœŸæ£€æµ‹ä¸æ°”å€™å¯è§†åŒ–</p>
    </div>

    <!-- æŠ¥å‘Šæ¦‚è¦ -->
    <div class="summary bg-blue-50 rounded-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">ğŸ“Š æŠ¥å‘Šæ¦‚è¦</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <p><strong>ç”Ÿæˆæ—¶é—´:</strong> 2025-11-23 14:48:58</p>
          <p><strong>åˆ†æåŸå¸‚:</strong> 16 ä¸ªå±±ä¸œåœ°å¸‚</p>
        </div>
        <div>
          <p><strong>ä¸»è¦å†œä½œç‰©:</strong> ç•ªèŒ„</p>
          <p><strong>æ•°æ®æ¥æº:</strong> å®æ—¶å¤©æ°”æ•°æ® + æ™ºèƒ½åˆ†æ</p>
        </div>
      </div>
    </div>

    <!-- æ•°æ®ç½‘æ ¼ -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
        <h3 class="text-lg font-semibold text-blue-600 mb-3">ğŸŒ¡ï¸ æ¸©åº¦åˆ†æ</h3>
        <p>å¹³å‡æ¸©åº¦: <strong>5.0Â°C</strong></p>
        <p>æœ€é«˜æ¸©åº¦: <strong>7.8Â°C</strong> (æ£åº„)</p>
        <p>æœ€ä½æ¸©åº¦: <strong>3.1Â°C</strong> (æ³°å®‰)</p>
        <p>æ¸©åº¦èŒƒå›´: 3.1Â°C ~ 7.8Â°C</p>
      </div>
      
      <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
        <h3 class="text-lg font-semibold text-blue-600 mb-3">ğŸ’§ æ¹¿åº¦åˆ†æ</h3>
        <p>å¹³å‡æ¹¿åº¦: <strong>66.9%</strong></p>
        <p>æœ€é«˜æ¹¿åº¦: <strong>83.0%</strong></p>
        <p>æœ€ä½æ¹¿åº¦: <strong>51.0%</strong></p>
        <p>æ¹¿åº¦é€‚å®œèŒƒå›´: 50% - 80%</p>
      </div>
      
      <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
        <h3 class="text-lg font-semibold text-blue-600 mb-3">ğŸŒ¾ å†œä½œç‰©é€‚å®œåº¦</h3>
        <p>å¹³å‡é€‚å®œåº¦: <strong>36.7%</strong> (è¾ƒå·®)</p>
        <p>æœ€é«˜é€‚å®œåº¦: <strong>50.0%</strong> (æ·„åš)</p>
        <p>æœ€ä½é€‚å®œåº¦: <strong>17.5%</strong></p>
        <p>æœ€é€‚å®œç§æ¤åœ°åŒº: æ·„åš</p>
      </div>
    </div>

    <!-- ç•ªèŒ„åˆ†æ -->
    <div class="bg-amber-50 border-l-4 border-amber-500 rounded-lg p-6 mb-6">
      <h3 class="text-xl font-bold mb-3">ğŸ“ˆ ç•ªèŒ„å‘è‚²æœŸåˆ†æ</h3>
      <p>å½“å‰æœ€é€‚å®œå‘è‚²æœŸ: <strong>å¹¼è‹—æœŸ</strong></p>
      <p>æœ€ä½³ç§æ¤åœ°åŒº: <strong>æ·„åš</strong></p>
      <p>å½“å‰æ¸©åº¦: 4.6Â°C | å½“å‰æ¹¿åº¦: 65.0%</p>
      <p>ç§æ¤å»ºè®®: é€‚å½“æ§æ°´ï¼ŒåŠ å¼ºé€šé£ï¼Œé¢„é˜²ç—…å®³</p>
    </div>

    <!-- å„åœ°å¸‚å¤©æ°”è¯¦æƒ… -->
    <div class="mb-6">
      <h3 class="text-xl font-bold mb-4">ğŸ™ï¸ å„åœ°å¸‚å¤©æ°”è¯¦æƒ…</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead>
            <tr class="bg-primary text-white">
              <th class="py-3 px-4 text-left">åŸå¸‚</th>
              <th class="py-3 px-4 text-left">å¤©æ°”</th>
              <th class="py-3 px-4 text-left">æ¸©åº¦</th>
              <th class="py-3 px-4 text-left">æ¹¿åº¦</th>
              <th class="py-3 px-4 text-left">é£å‘</th>
              <th class="py-3 px-4 text-left">é£åŠ›</th>
              <th class="py-3 px-4 text-left">é€‚å®œåº¦</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b border-gray-200 hover:bg-gray-50">
              <td class="py-3 px-4">æµå—</td>
              <td class="py-3 px-4">å°é›¨</td>
              <td class="py-3 px-4">4.4Â°C</td>
              <td class="py-3 px-4">79%</td>
              <td class="py-3 px-4">åŒ—é£</td>
              <td class="py-3 px-4">1çº§</td>
              <td class="py-3 px-4">27.5%</td>
            </tr>
            <tr class="border-b border-gray-200 hover:bg-gray-50">
              <td class="py-3 px-4">é’å²›</td>
              <td class="py-3 px-4">æ™´</td>
              <td class="py-3 px-4">6.1Â°C</td>
              <td class="py-3 px-4">51%</td>
              <td class="py-3 px-4">åŒ—é£</td>
              <td class="py-3 px-4">2çº§</td>
              <td class="py-3 px-4">40.0%</td>
            </tr>
            <tr class="border-b border-gray-200 hover:bg-gray-50">
              <td class="py-3 px-4">æ·„åš</td>
              <td class="py-3 px-4">å°é›¨</td>
              <td class="py-3 px-4">4.6Â°C</td>
              <td class="py-3 px-4">65%</td>
              <td class="py-3 px-4">åŒ—é£</td>
              <td class="py-3 px-4">1çº§</td>
              <td class="py-3 px-4">50.0%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 3Dåœ°å½¢ä¸æ°”å€™åˆ†å¸ƒå›¾ -->
    <div class="bg-gray-100 rounded-lg p-8 text-center">
      <h3 class="text-xl font-bold mb-2">ğŸ—ºï¸ 3Dåœ°å½¢ä¸æ°”å€™åˆ†å¸ƒå›¾</h3>
      <p class="text-gray-600">æ³¨: 3Däº¤äº’å¼åœ°å›¾è¯·åœ¨æ¡Œé¢åº”ç”¨ç¨‹åºä¸­æŸ¥çœ‹</p>
      <p class="text-gray-600">å½“å‰æ¨¡å¼: terrain | åˆ†æä½œç‰©: ç•ªèŒ„</p>
    </div>

    <!-- æŠ¥å‘Šç”Ÿæˆæ—¶é—´ -->
    <div class="text-right text-gray-500 mt-6">
      <p>æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-23 14:48:58</p>
    </div>
  </div>
</div>

<!-- é¡µè„š -->
<footer class="bg-neutral-dark text-white py-8" id="mainFooter">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <div class="flex items-center space-x-2 mb-4">
          <i class="fa fa-leaf text-green-400 text-2xl"></i>
          <h3 class="text-xl font-bold">æ•°å­—åŒ–å­ªç”Ÿå†œåœº</h3>
        </div>
        <p class="text-gray-400 text-sm max-w-md">
          åˆ©ç”¨ç‰©è”ç½‘æŠ€æœ¯å®ç°å†œä¸šç”Ÿäº§ç¯å¢ƒçš„æ™ºèƒ½ç›‘æµ‹ä¸ç®¡ç†ï¼Œ
          æé«˜å†œä¸šç”Ÿäº§æ•ˆç‡ä¸äº§å“è´¨é‡ï¼Œæ¨åŠ¨å†œä¸šç°ä»£åŒ–å‘å±•ã€‚
        </p>
      </div>
      <div>
        <h4 class="font-semibold mb-4">å¿«é€Ÿé“¾æ¥</h4>
        <div class="grid grid-cols-2 gap-4">
          <ul class="space-y-2 text-gray-400 text-sm">
            <li><a href="#overview" class="hover:text-white transition-colors">å¹³å°æ¦‚è§ˆ</a></li>
            <li><a href="#outdoor" class="hover:text-white transition-colors">æˆ·å¤–ç¯å¢ƒ</a></li>
          </ul>
          <ul class="space-y-2 text-gray-400 text-sm">
            <li><a href="#weather" class="hover:text-white transition-colors">å¤©æ°”ä¿¡æ¯</a></li>
            <li><a href="#indoor" class="hover:text-white transition-colors">ç¯å¢ƒç›‘æµ‹</a></li>
          </ul>
        </div>
    </div>
    <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-500 text-sm">
      <p>Â© 2025 æ•°å­—åŒ–å­ªç”Ÿå†œåœº | æ™ºæ…§å†œä¸šç›‘æµ‹å¹³å°</p>
    </div>
  </div>
</footer>

<!-- JavaScript -->
<script>
// AIåŠ©æ‰‹åŠŸèƒ½
let aiAssistantOpen = false;

// åˆå§‹åŒ–AIåŠ©æ‰‹
function initAIAssistant() {
  const aiButton = document.getElementById('aiAssistantButton');
  const aiWindow = document.getElementById('aiChatWindow');
  const aiClose = document.getElementById('aiChatClose');
  const aiSend = document.getElementById('aiChatSend');
  
  // åˆ‡æ¢AIåŠ©æ‰‹çª—å£
  aiButton.addEventListener('click', function() {
    aiAssistantOpen = !aiAssistantOpen;
    aiWindow.classList.toggle('active');
    aiButton.classList.toggle('active');
    
    if (aiAssistantOpen) {
      // æ»šåŠ¨åˆ°åº•éƒ¨
      const messages = document.getElementById('aiChatMessages');
      messages.scrollTop = messages.scrollHeight;
    }
  });
  
  // å…³é—­AIåŠ©æ‰‹çª—å£
  aiClose.addEventListener('click', function() {
    aiAssistantOpen = false;
    aiWindow.classList.remove('active');
    aiButton.classList.remove('active');
  });
  
  // å‘é€æ¶ˆæ¯
  aiSend.addEventListener('click', sendAIMessage);
  
  // ç‚¹å‡»å¤–éƒ¨å…³é—­AIåŠ©æ‰‹çª—å£
  document.addEventListener('click', function(event) {
    if (aiAssistantOpen && 
        !aiWindow.contains(event.target) && 
        !aiButton.contains(event.target)) {
      aiAssistantOpen = false;
      aiWindow.classList.remove('active');
      aiButton.classList.remove('active');
    }
  });
}

// å‘é€AIæ¶ˆæ¯
function sendAIMessage() {
  const input = document.getElementById('aiChatInput');
  const message = input.value.trim();
  
  if (!message) return;
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  addAIMessage('user', message);
  input.value = '';
  
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  showAILoading();
  
  // æ¨¡æ‹ŸAIå“åº”å»¶è¿Ÿ
  setTimeout(() => {
    // è·å–AIå“åº”
    const response = getAIResponse(message);
    // ç§»é™¤åŠ è½½çŠ¶æ€
    removeAILoading();
    // æ·»åŠ AIå“åº”
    addAIMessage('bot', response);
  }, 1000);
}

// æ·»åŠ AIæ¶ˆæ¯
function addAIMessage(sender, content) {
  const messages = document.getElementById('aiChatMessages');
  const now = new Date();
  const timeStr = now.toLocaleString('zh-CN');
  
  const messageDiv = document.createElement('div');
  messageDiv.className = `ai-message ${sender}`;
  messageDiv.innerHTML = `
    <div class="message-bubble">${content}</div>
    <div class="message-time">${timeStr}</div>
  `;
  
  messages.appendChild(messageDiv);
  messages.scrollTop = messages.scrollHeight;
}

// æ˜¾ç¤ºAIåŠ è½½çŠ¶æ€
function showAILoading() {
  const messages = document.getElementById('aiChatMessages');
  const loadingDiv = document.createElement('div');
  loadingDiv.className = 'ai-loading';
  loadingDiv.id = 'aiLoading';
  loadingDiv.innerHTML = `
    <div class="ai-loading-dot"></div>
    <div class="ai-loading-dot"></div>
    <div class="ai-loading-dot"></div>
  `;
  
  messages.appendChild(loadingDiv);
  messages.scrollTop = messages.scrollHeight;
}

// ç§»é™¤AIåŠ è½½çŠ¶æ€
function removeAILoading() {
  const loading = document.getElementById('aiLoading');
  if (loading) {
    loading.remove();
  }
}

// è·å–AIå“åº”ï¼ˆæœ¬åœ°è§„åˆ™å¼•æ“ï¼‰
function getAIResponse(message) {
  const lowerMessage = message.toLowerCase();
  
  // ç‰ç±³ç›¸å…³é—®é¢˜
  if (lowerMessage.includes('ç‰ç±³') && lowerMessage.includes('é»„') && lowerMessage.includes('æ–‘ç‚¹')) {
    return `<strong>ğŸŒ½ ç‰ç±³å¶ç‰‡é»„è¤è‰²æ–‘ç‚¹é—®é¢˜åˆ†æ</strong><br><br>
            <strong>å¯èƒ½åŸå› ï¼š</strong><br>
            1. <strong>ç‰ç±³å¤§æ–‘ç—…/å°æ–‘ç—…</strong>ï¼šçœŸèŒæ€§ç—…å®³ï¼Œå¶ç‰‡å‡ºç°é»„è¤è‰²æ¤­åœ†å½¢ç—…æ–‘<br>
            2. <strong>ç¼ºé’¾ç—‡çŠ¶</strong>ï¼šè€å¶è¾¹ç¼˜å…ˆå‘é»„ï¼Œé€æ¸å‘å†…æ‰©å±•<br>
            3. <strong>è¯å®³</strong>ï¼šé™¤è‰å‰‚ä½¿ç”¨ä¸å½“é€ æˆçš„ç¼ä¼¤æ–‘<br>
            4. <strong>ç”Ÿç†æ€§ç—…å®³</strong>ï¼šæ’æ°´ä¸è‰¯æˆ–å¹²æ—±èƒè¿«<br><br>
            
            <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
            1. <strong>ç—…å®³é˜²æ²»</strong>ï¼šå–·æ–½è‹¯é†šç”²ç¯å”‘+å˜§èŒé…¯ï¼Œ7-10å¤©ä¸€æ¬¡ï¼Œè¿ç»­2-3æ¬¡<br>
            2. <strong>è¡¥å……è¥å…»</strong>ï¼šå¶é¢å–·æ–½ç£·é…¸äºŒæ°¢é’¾+èŠ¸è‹”ç´ å†…é…¯<br>
            3. <strong>ç”°é—´ç®¡ç†</strong>ï¼šåŠæ—¶æ’æ°´ï¼Œä¸­è€•æ¾åœŸï¼Œå¢å¼ºæ ¹ç³»æ´»åŠ›<br>
            4. <strong>é¢„é˜²æªæ–½</strong>ï¼šé€‰ç”¨æŠ—ç—…å“ç§ï¼Œåˆç†è½®ä½œï¼Œæ¸…é™¤ç”°é—´ç—…æ®‹ä½“<br><br>
            
            <strong>ğŸ’¡ å»ºè®®ï¼š</strong>å…ˆè§‚å¯Ÿç—…æ–‘ç‰¹å¾ï¼Œç¡®è¯Šåå†é’ˆå¯¹æ€§ç”¨è¯ï¼Œé¿å…ç›²ç›®æ–½è¯ã€‚`;
  }
  
  // ç•ªèŒ„ç§æ¤è®¡åˆ’
  else if (lowerMessage.includes('ç•ªèŒ„') && lowerMessage.includes('ç§æ¤') && (lowerMessage.includes('è®¡åˆ’') || lowerMessage.includes('ç®¡ç†'))) {
    return `<strong>ğŸ… å¤§æ£šç•ªèŒ„ç§æ¤ç®¡ç†è®¡åˆ’</strong><br><br>
            
            <strong>1ï¸âƒ£ è‚²è‹—æœŸï¼ˆ25-30å¤©ï¼‰</strong><br>
            â€¢ <strong>æ¸©åº¦ç®¡ç†</strong>ï¼šæ˜¼æ¸©25-28Â°Cï¼Œå¤œæ¸©15-18Â°C<br>
            â€¢ <strong>æ°´åˆ†ç®¡ç†</strong>ï¼šä¿æŒåŸºè´¨æ¹¿æ¶¦ä¸ç§¯æ°´<br>
            â€¢ <strong>æ–½è‚¥</strong>ï¼šå‡ºè‹—å7å¤©å¼€å§‹ï¼Œæ¯å‘¨ä¸€æ¬¡20-20-20å¹³è¡¡è‚¥<br><br>
            
            <strong>2ï¸âƒ£ å®šæ¤æœŸ</strong><br>
            â€¢ <strong>æ—¶é—´</strong>ï¼šè‹—é¾„30å¤©ï¼Œ4-5ç‰‡çœŸå¶<br>
            â€¢ <strong>å¯†åº¦</strong>ï¼šè¡Œè·70cmï¼Œæ ªè·40cmï¼Œäº©æ ½2000-2200æ ª<br>
            â€¢ <strong>åŸºè‚¥</strong>ï¼šäº©æ–½è…ç†Ÿæœ‰æœºè‚¥3-4å¨ï¼Œå¤åˆè‚¥50kg<br><br>
            
            <strong>3ï¸âƒ£ ç”Ÿé•¿æœŸç®¡ç†</strong><br>
            â€¢ <strong>æ¸©åº¦</strong>ï¼šæ˜¼æ¸©22-28Â°Cï¼Œå¤œæ¸©12-16Â°C<br>
            â€¢ <strong>æ¹¿åº¦</strong>ï¼šç›¸å¯¹æ¹¿åº¦60-70%<br>
            â€¢ <strong>è¿½è‚¥</strong>ï¼šç¬¬ä¸€ç©—æœè†¨å¤§æœŸè¿½è‚¥ï¼Œæ°®ç£·é’¾æ¯”ä¾‹2:1:3<br><br>
            
            <strong>4ï¸âƒ£ èŠ±æœæœŸç®¡ç†</strong><br>
            â€¢ <strong>ä¿èŠ±ä¿æœ</strong>ï¼šæ¸©åº¦15-30Â°Cï¼Œå–·æ–½é˜²è½ç´ <br>
            â€¢ <strong>ç–èŠ±ç–æœ</strong>ï¼šæ¯ç©—ç•™4-5ä¸ªæœ<br>
            â€¢ <strong>ç—…è™«å®³é˜²æ²»</strong>ï¼šé¢„é˜²æ—©ç–«ç—…ã€æ™šç–«ç—…ã€ç°éœ‰ç—…<br><br>
            
            <strong>5ï¸âƒ£ é‡‡æ”¶æœŸ</strong><br>
            â€¢ <strong>é‡‡æ”¶æ ‡å‡†</strong>ï¼šæœå®è½¬è‰²æœŸ<br>
            â€¢ <strong>äº§é‡é¢„æœŸ</strong>ï¼šäº©äº§6000-8000kg<br>
            â€¢ <strong>é‡‡æ”¶åç®¡ç†</strong>ï¼šåŠæ—¶æ¸…ç†ç—…æ®‹ä½“ï¼ŒåœŸå£¤æ¶ˆæ¯’`;
  }
  
  // æ°´ç¨»èŠ‚æ°´çŒæº‰
  else if ((lowerMessage.includes('æ°´ç¨»') || lowerMessage.includes('çŒæº‰')) && lowerMessage.includes('èŠ‚æ°´')) {
    return `<strong>ğŸŒ¾ æ°´ç¨»èŠ‚æ°´çŒæº‰æ–¹æ¡ˆï¼ˆ50äº©è§„æ¨¡ï¼‰</strong><br><br>
            
            <strong>1ï¸âƒ£ æ ¸å¿ƒçŒæº‰æ¨¡å¼</strong><br>
            â€¢ <strong>æ§åˆ¶çŒæº‰æŠ€æœ¯</strong>ï¼šæ ¹æ®æ°´ç¨»éœ€æ°´è§„å¾‹ç²¾å‡†ä¾›æ°´<br>
            â€¢ <strong>æµ…æ¹¿çŒæº‰</strong>ï¼š"æµ…æ°´å±‚-æ¹¿æ¶¦-æµ…æ°´å±‚"äº¤æ›¿ï¼ŒèŠ‚æ°´20-30%<br><br>
            
            <strong>2ï¸âƒ£ åˆ†ç”Ÿè‚²æœŸç®¡ç†</strong><br>
            â€¢ <strong>åˆ†è˜–æœŸ</strong>ï¼šæµ…æ°´å‹¤çŒï¼Œä¿æŒç”°é—´æ¹¿æ¶¦<br>
            â€¢ <strong>æ‹”èŠ‚å­•ç©—æœŸ</strong>ï¼šä¿æŒ3-5cmæµ…æ°´å±‚<br>
            â€¢ <strong>æŠ½ç©—æ‰¬èŠ±æœŸ</strong>ï¼šç»´æŒæ°´å±‚ä¿éšœæˆç²‰<br>
            â€¢ <strong>çŒæµ†æˆç†ŸæœŸ</strong>ï¼šå¹²æ¹¿äº¤æ›¿ï¼Œä¿ƒè¿›ç±½ç²’é¥±æ»¡<br><br>
            
            <strong>3ï¸âƒ£ å…³é”®èŠ‚æ°´æªæ–½</strong><br>
            â€¢ <strong>ç”°åŸ‚é˜²æ¸—</strong>ï¼šç¡¬åŒ–ç”°åŸ‚æˆ–é“ºè®¾é˜²æ¸—è†œ<br>
            â€¢ <strong>åˆ†åŒºåˆ†ç‰‡</strong>ï¼šåˆ’åˆ†ä¸º10-15äº©å°åŒºï¼Œè½®çŒæé«˜æ•ˆç‡<br>
            â€¢ <strong>åœŸå£¤å¢’æƒ…ç›‘æµ‹</strong>ï¼šå®‰è£…æ¹¿åº¦ä¼ æ„Ÿå™¨ï¼ŒæŒ‰éœ€çŒæº‰<br>
            â€¢ <strong>ç§¸ç§†è¦†ç›–</strong>ï¼šè¡Œé—´è¦†ç›–ç§¸ç§†ï¼Œå‡å°‘è’¸å‘30%ä»¥ä¸Š<br><br>
            
            <strong>4ï¸âƒ£ é¢„æœŸèŠ‚æ°´æ•ˆæœ</strong><br>
            â€¢ ä¼ ç»Ÿæ¼«çŒï¼šäº©å‡ç”¨æ°´800-1000mÂ³<br>
            â€¢ æœ¬æ–¹æ¡ˆï¼šäº©å‡ç”¨æ°´500-600mÂ³<br>
            â€¢ <strong>50äº©å¹´èŠ‚æ°´ï¼š</strong>çº¦15000-20000mÂ³<br><br>
            
            <strong>ğŸ’¡ å®æ–½å»ºè®®ï¼š</strong><br>
            å…ˆé€‰æ‹©10äº©è¯•ç‚¹ï¼Œå®‰è£…ç®€æ˜“åœŸå£¤æ¹¿åº¦è®¡ï¼Œæ ¹æ®ä½œç‰©éœ€æ°´è§„å¾‹è°ƒæ•´çŒæº‰åˆ¶åº¦ï¼Œé€æ­¥æ¨å¹¿è‡³å…¨ç”°ã€‚`;
  }
  
  // å°éº¦ç—…è™«å®³
  else if (lowerMessage.includes('å°éº¦') && lowerMessage.includes('ç—…è™«')) {
    return `<strong>ğŸŒ¾ å°éº¦ç—…è™«å®³ç»¼åˆé˜²æ²»æ–¹æ¡ˆ</strong><br><br>
            
            <strong>1ï¸âƒ£ ä¸»è¦ç—…å®³é˜²æ²»</strong><br>
            â€¢ <strong>ç™½ç²‰ç—…</strong>ï¼šä¸‰å”‘é…®ã€æˆŠå”‘é†‡ã€å˜§èŒé…¯è½®æ¢ä½¿ç”¨<br>
            â€¢ <strong>é”ˆç—…</strong>ï¼šæˆŠå”‘é†‡ã€æ°Ÿç¯å”‘ã€ä¸™ç¯å”‘<br>
            â€¢ <strong>èµ¤éœ‰ç—…</strong>ï¼šæŠ½ç©—æ‰¬èŠ±æœŸé¢„é˜²ï¼Œæ°°çƒ¯èŒé…¯ã€æˆŠå”‘é†‡<br>
            â€¢ <strong>çº¹æ¯ç—…</strong>ï¼šæ’­ç§æœŸæ‹Œç§ï¼Œç”Ÿé•¿æœŸè‹¯é†šç”²ç¯å”‘<br><br>
            
            <strong>2ï¸âƒ£ ä¸»è¦è™«å®³é˜²æ²»</strong><br>
            â€¢ <strong>èšœè™«</strong>ï¼šå¡è™«å•‰ã€å•¶è™«è„’ã€æ°Ÿå•¶è™«èƒºè…ˆ<br>
            â€¢ <strong>çº¢èœ˜è››</strong>ï¼šé˜¿ç»´èŒç´ ã€å“’è¨çµã€èºè¨é…¯<br>
            â€¢ <strong>å¸æµ†è™«</strong>ï¼šè›¹æœŸæ¯’åœŸå¤„ç†ï¼Œæˆè™«æœŸå–·é›¾<br><br>
            
            <strong>3ï¸âƒ£ ç»¼åˆé˜²æ²»ç­–ç•¥</strong><br>
            â€¢ <strong>å†œä¸šé˜²æ²»</strong>ï¼šé€‰ç”¨æŠ—ç—…å“ç§ï¼Œåˆç†è½®ä½œ<br>
            â€¢ <strong>ç”Ÿç‰©é˜²æ²»</strong>ï¼šä¿æŠ¤åˆ©ç”¨å¤©æ•Œï¼Œä½¿ç”¨ç”Ÿç‰©å†œè¯<br>
            â€¢ <strong>åŒ–å­¦é˜²æ²»</strong>ï¼šç§‘å­¦ç”¨è¯ï¼Œè½®æ¢ä½¿ç”¨ï¼Œå‡å°‘æŠ—æ€§<br><br>
            
            <strong>ğŸ’¡ å…³é”®é˜²æ²»æ—¶æœŸï¼š</strong><br>
            â€¢ è¿”é’æ‹”èŠ‚æœŸï¼šçº¹æ¯ç—…ã€çº¢èœ˜è››<br>
            â€¢ æŠ½ç©—æ‰¬èŠ±æœŸï¼šèµ¤éœ‰ç—…ã€èšœè™«<br>
            â€¢ çŒæµ†æœŸï¼šç™½ç²‰ç—…ã€é”ˆç—…ã€èšœè™«`;
  }
  
  // é»˜è®¤å“åº”
  else {
    return `æ„Ÿè°¢æ‚¨çš„æé—®ï¼æˆ‘ä¸»è¦æ“…é•¿ä»¥ä¸‹å†œä¸šé—®é¢˜çš„è§£ç­”ï¼š<br><br>
            1. <strong>ä½œç‰©ç—…è™«å®³è¯Šæ–­ä¸é˜²æ²»</strong>ï¼ˆç‰ç±³ã€æ°´ç¨»ã€å°éº¦ã€ç•ªèŒ„ç­‰ï¼‰<br>
            2. <strong>ç§æ¤æŠ€æœ¯ä¸ç®¡ç†æ–¹æ¡ˆ</strong>ï¼ˆå¤§æ£šç•ªèŒ„ã€é»„ç“œã€è‰è“ç­‰ï¼‰<br>
            3. <strong>èŠ‚æ°´çŒæº‰ä¸æ°´è‚¥ç®¡ç†</strong>ï¼ˆæ°´ç¨»ã€å°éº¦ã€ç‰ç±³ç­‰ï¼‰<br>
            4. <strong>åœŸå£¤æ”¹è‰¯ä¸æ–½è‚¥å»ºè®®</strong><br>
            5. <strong>å†œä¸šæ°”è±¡ä¸ç¾å®³é¢„é˜²</strong><br><br>
            
            æ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹é—®é¢˜ï¼š<br>
            â€¢ "æˆ‘çš„ç‰ç±³å¶å­å‘é»„æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ"<br>
            â€¢ "å¤§æ£šç•ªèŒ„å¦‚ä½•ç®¡ç†æ¸©å·®ï¼Ÿ"<br>
            â€¢ "æ°´ç¨»ç”°æ€ä¹ˆèŠ‚æ°´çŒæº‰ï¼Ÿ"<br>
            â€¢ "å°éº¦ç—…è™«å®³æ€ä¹ˆé˜²æ²»ï¼Ÿ"<br><br>
            
            æˆ‘ä¼šæ ¹æ®æ‚¨çš„å…·ä½“é—®é¢˜æä¾›è¯¦ç»†çš„æŠ€æœ¯æŒ‡å¯¼ï¼`;
  }
}

// å¿«é€Ÿæé—®åŠŸèƒ½
function askQuickQuestion(question) {
  const input = document.getElementById('aiChatInput');
  input.value = question;
  sendAIMessage();
}

// å¤„ç†AIè¾“å…¥æ¡†å›è½¦é”®
function handleAiInputKeypress(event) {
  if (event.key === 'Enter') {
    sendAIMessage();
  }
}

// é¡µé¢åˆ‡æ¢åŠŸèƒ½
function showClimateReport() {
  document.getElementById('mainContent').classList.add('hidden');
  document.getElementById('mainFooter').classList.add('hidden');
  document.getElementById('climateReportPage').classList.remove('hidden');
  
  // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  
  // ä¸ºæ°”å€™åˆ†æé“¾æ¥æ·»åŠ æ¿€æ´»çŠ¶æ€
  document.querySelectorAll('a[href="/climate-report"]').forEach(link => {
    link.classList.add('active');
  });
}

function showMainDashboard() {
  document.getElementById('mainContent').classList.remove('hidden');
  document.getElementById('mainFooter').classList.remove('hidden');
  document.getElementById('climateReportPage').classList.add('hidden');
  
  // æ¢å¤å¯¼èˆªæ¿€æ´»çŠ¶æ€
  initNavLinks();
}

// ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
document.getElementById('menuBtn').addEventListener('click', function() {
  const mobileMenu = document.getElementById('mobileMenu');
  mobileMenu.classList.toggle('hidden');
});

// æ˜¾ç¤ºå½“å‰æ—¶é—´
function updateTime() {
  const now = new Date();
  const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' };
  document.getElementById('currentTime').textContent = now.toLocaleString('zh-CN', options);
}
updateTime();
setInterval(updateTime, 1000);

// å›¾è¡¨å®ä¾‹
let tempHumidityChart, lightChart;

// åˆå§‹åŒ–äº¤äº’åŠŸèƒ½
function initInteractiveFeatures() {
  // åˆå§‹åŒ–å¯¼èˆªé“¾æ¥æ¿€æ´»çŠ¶æ€
  initNavLinks();
  // åˆå§‹åŒ–å›¾è¡¨äº¤äº’
  initChartInteractions();
  // åˆå§‹åŒ–æ•°æ®å¡ç‰‡äº¤äº’
  initDataCardInteractions();
  // åˆå§‹åŒ–å¤©æ°”åŠŸèƒ½
  initWeatherFeatures();
  // åˆå§‹åŒ–AIåŠ©æ‰‹
  initAIAssistant();
}

// åˆå§‹åŒ–å¯¼èˆªé“¾æ¥æ¿€æ´»çŠ¶æ€
function initNavLinks() {
  const navLinks = document.querySelectorAll('.nav-link');
  const sections = document.querySelectorAll('section');

  // ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ›´æ–°å¯¼èˆªé“¾æ¥æ¿€æ´»çŠ¶æ€
  window.addEventListener('scroll', function() {
    let current = '';
    sections.forEach(section => {
      const sectionTop = section.offsetTop;
      const sectionHeight = section.clientHeight;
      if (pageYOffset >= sectionTop - 100) {
        current = section.getAttribute('id');
      }
    });

    navLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === `#${current}`) {
        link.classList.add('active');
      }
    });
  });
}

// åˆå§‹åŒ–å›¾è¡¨äº¤äº’
function initChartInteractions() {
  // ä¸ºå›¾è¡¨æ·»åŠ é¼ æ ‡æ‚¬åœæ•ˆæœ
  const tempHumidityCanvas = document.getElementById('tempHumidityChart');
  const lightCanvas = document.getElementById('lightChart');
  const tempHumidityTooltip = document.getElementById('tempHumidityTooltip');
  const lightTooltip = document.getElementById('lightTooltip');

  // æ¸©åº¦æ¹¿åº¦å›¾è¡¨äº¤äº’
  if (tempHumidityCanvas) {
    tempHumidityCanvas.addEventListener('mousemove', function(e) {
      const rect = tempHumidityCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // ç®€å•æ¨¡æ‹Ÿæ•°æ®ç‚¹æ‚¬åœæ•ˆæœ
      const dataIndex = Math.floor(x / (rect.width / 7));
      if (dataIndex >= 0 && dataIndex < 7) {
        const tempData = [5.5, 4.8, 7.3, 12.7, 13.5, 10.2, 9.8];
        const humidityData = [72, 75, 68, 55, 52, 60, 62];
        const labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'ç°åœ¨'];

        tempHumidityTooltip.innerHTML = `
          <div>æ—¶é—´: ${labels[dataIndex]}</div>
          <div>æ¸©åº¦: ${tempData[dataIndex].toFixed(2)}Â°C</div>
          <div>æ¹¿åº¦: ${humidityData[dataIndex].toFixed(2)}%</div>
        `;
        tempHumidityTooltip.style.left = `${x + 10}px`;
        tempHumidityTooltip.style.top = `${y + 10}px`;
        tempHumidityTooltip.style.opacity = '1';
      }
    });

    tempHumidityCanvas.addEventListener('mouseleave', function() {
      tempHumidityTooltip.style.opacity = '0';
    });
  }

  // å…‰ç…§å›¾è¡¨äº¤äº’
  if (lightCanvas) {
    lightCanvas.addEventListener('mousemove', function(e) {
      const rect = lightCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // ç®€å•æ¨¡æ‹Ÿæ•°æ®ç‚¹æ‚¬åœæ•ˆæœ
      const dataIndex = Math.floor(x / (rect.width / 7));
      if (dataIndex >= 0 && dataIndex < 7) {
        const lightData = [0, 0, 3.2, 5.8, 5.5, 2.2, 0.5];
        const labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'ç°åœ¨'];

        lightTooltip.innerHTML = `
          <div>æ—¶é—´: ${labels[dataIndex]}</div>
          <div>å…‰ç…§å¼ºåº¦: ${lightData[dataIndex].toFixed(2)}åƒlx</div>
        `;
        lightTooltip.style.left = `${x + 10}px`;
        lightTooltip.style.top = `${y + 10}px`;
        lightTooltip.style.opacity = '1';
      }
    });

    lightCanvas.addEventListener('mouseleave', function() {
      lightTooltip.style.opacity = '0';
    });
  }
}

// åˆå§‹åŒ–æ•°æ®å¡ç‰‡äº¤äº’
function initDataCardInteractions() {
  const dataCards = document.querySelectorAll('.data-card');

  dataCards.forEach(card => {
    // ç‚¹å‡»å¡ç‰‡å±•å¼€/æ”¶èµ·
    card.addEventListener('click', function() {
      if (this.classList.contains('expanded')) {
        this.classList.remove('expanded');
      } else {
        // å…ˆæ”¶èµ·æ‰€æœ‰å·²å±•å¼€çš„å¡ç‰‡
        dataCards.forEach(c => c.classList.remove('expanded'));
        // å†å±•å¼€å½“å‰å¡ç‰‡
        this.classList.add('expanded');
      }
    });

    // åŒå‡»å¡ç‰‡æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
    card.addEventListener('dblclick', function() {
      alert('æ˜¾ç¤ºè¯¦ç»†æ•°æ®ä¿¡æ¯');
    });
  });
}

// åˆå§‹åŒ–å¤©æ°”åŠŸèƒ½
function initWeatherFeatures() {
  const refreshWeatherBtn = document.getElementById('refresh-weather-btn');

  // åˆ·æ–°å¤©æ°”æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  if (refreshWeatherBtn) {
    refreshWeatherBtn.addEventListener('click', function() {
      // æ·»åŠ åˆ·æ–°åŠ¨ç”»
      this.querySelector('i').classList.add('refresh-animation');
      setTimeout(() => {
        this.querySelector('i').classList.remove('refresh-animation');
      }, 500);
      fetchWeatherData();
    });
  }

  // åˆå§‹åŠ è½½å¤©æ°”æ•°æ®
  fetchWeatherData();

  // è®¾ç½®è‡ªåŠ¨åˆ·æ–°å¤©æ°”æ•°æ®ï¼ˆæ¯30åˆ†é’Ÿä¸€æ¬¡ï¼‰
  setInterval(fetchWeatherData, 1800000);
}

// è·å–å¤©æ°”æ•°æ® - ä¿®æ”¹ä¸ºå›ºå®šå°é›ªå¤©æ°”
function fetchWeatherData() {
  // å›ºå®šä¸ºå°é›ªå¤©æ°”ï¼Œæ¸©åº¦-1åº¦
  const now = new Date();
  const updateTime = now.toLocaleTimeString('zh-CN');
  
  // è®¡ç®—ä¸‹ä¸€æ¬¡æ›´æ–°æ—¶é—´
  const nextUpdate = new Date(now.getTime() + 30 * 60 * 1000);
  const nextUpdateTime = nextUpdate.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
  
  // æ›´æ–°ä¸‹ä¸€æ¬¡æ›´æ–°æ—¶é—´æ˜¾ç¤º
  const forecastUpdateTime = document.getElementById('forecast-update-time');
  if (forecastUpdateTime) {
    forecastUpdateTime.textContent = `ä¸‹æ¬¡æ›´æ–°: ${nextUpdateTime}`;
  }

  const weatherData = {
    current: {
      temp: -1, // å›ºå®šä¸º-1åº¦
      desc: 'å°é›ª', // å›ºå®šä¸ºå°é›ª
      humidity: 85, // å°é›ªå¤©æ°”é€šå¸¸æ¹¿åº¦è¾ƒé«˜
      windSpeed: 8, // é£é€Ÿ8 km/h
      windDir: 'åŒ—é£', // åŒ—é£
      feelsLike: -3, // ä½“æ„Ÿæ¸©åº¦-3åº¦
      uv: '1 å¼±', // ç´«å¤–çº¿æŒ‡æ•°å¼±
      visibility: 8, // å°é›ªå¤©æ°”èƒ½è§åº¦è¾ƒä½ï¼Œ8km
      sunrise: '07:15', // å†¬å­£æ—¥å‡ºè¾ƒæ™š
      sunset: '16:58', // å†¬å­£æ—¥è½è¾ƒæ—©
      precipitation: 85, // é™æ°´æ¦‚ç‡85%
      pressure: 1018, // æ°”å‹1018 hPa
      aqi: 35, // ç©ºæ°”è´¨é‡ä¼˜
      aqiLevel: 'ä¼˜',
      dewPoint: -4, // éœ²ç‚¹-4Â°C
      cloudCover: 90, // äº‘é‡90%
      updateTime: updateTime
    },
    forecast: generateRealTimeForecast()
  };

  updateWeatherDashboard(weatherData);
}

// ç”Ÿæˆå®æ—¶å¤©æ°”é¢„æŠ¥ - ä¿®æ”¹ä¸ºå°é›ªç›¸å…³çš„å¤©æ°”é¢„æŠ¥
function generateRealTimeForecast() {
  const forecasts = [];
  const today = new Date();
  
  // å°é›ªå¤©æ°”ç›¸å…³çš„é¢„æŠ¥
  const snowForecasts = [
    { desc: 'å°é›ª', high: -2, low: -5, icon: 'fa-snowflake-o' },
    { desc: 'é˜´', high: -1, low: -4, icon: 'fa-cloud' },
    { desc: 'å¤šäº‘', high: 0, low: -3, icon: 'fa-cloud' },
    { desc: 'æ™´', high: 2, low: -2, icon: 'fa-sun-o' }
  ];
  
  for (let i = 1; i <= 4; i++) {
    const forecastDate = new Date(today);
    forecastDate.setDate(today.getDate() + i);
    
    // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
    const month = forecastDate.getMonth() + 1;
    const day = forecastDate.getDate();
    const weekDay = getWeekDay(forecastDate.getDay());
    
    const dateStr = `${month}æœˆ${day}æ—¥`;
    const weekStr = weekDay;
    
    const forecast = snowForecasts[i-1] || snowForecasts[0];
    
    forecasts.push({
      date: dateStr,
      weekDay: weekStr,
      temp: `${forecast.high}/${forecast.low}Â°C`,
      desc: forecast.desc,
      icon: forecast.icon
    });
  }
  
  return forecasts;
}

// è·å–æ˜ŸæœŸå‡ 
function getWeekDay(day) {
  const weekDays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
  return weekDays[day];
}

// æ›´æ–°å¤©æ°”ä»ªè¡¨æ¿
function updateWeatherDashboard(data) {
  // æ›´æ–°å½“å‰å¤©æ°”
  const currentTemp = document.getElementById('current-temp');
  const weatherDesc = document.getElementById('weather-desc');
  const currentHumidity = document.getElementById('current-humidity');
  const currentWind = document.getElementById('current-wind');
  const currentWindDir = document.getElementById('current-wind-dir');
  const currentFeelsLike = document.getElementById('current-feels-like');
  const currentUv = document.getElementById('current-uv');
  const currentVisibility = document.getElementById('current-visibility');
  const updateTime = document.getElementById('update-time');
  
  if (currentTemp) currentTemp.textContent = `${data.current.temp}Â°C`;
  if (weatherDesc) weatherDesc.textContent = data.current.desc;
  if (currentHumidity) currentHumidity.textContent = `${data.current.humidity}%`;
  if (currentWind) currentWind.textContent = `${data.current.windSpeed} km/h`;
  if (currentWindDir) currentWindDir.textContent = data.current.windDir;
  if (currentFeelsLike) currentFeelsLike.textContent = `${data.current.feelsLike}Â°C`;
  if (currentUv) currentUv.textContent = data.current.uv;
  if (currentVisibility) currentVisibility.textContent = `${data.current.visibility} km`;
  if (updateTime) updateTime.textContent = `æ›´æ–°æ—¶é—´: ${data.current.updateTime}`;

  // æ›´æ–°å¤©æ°”ä¿¡æ¯
  const sunriseSunset = document.getElementById('sunrise-sunset');
  const precipitation = document.getElementById('precipitation');
  const pressure = document.getElementById('pressure');
  const aqiValue = document.getElementById('aqi-value');
  const aqiLevel = document.getElementById('aqi-level');
  const dewPoint = document.getElementById('dew-point');
  const cloudCover = document.getElementById('cloud-cover');
  
  if (sunriseSunset) sunriseSunset.textContent = `${data.current.sunrise} / ${data.current.sunset}`;
  if (precipitation) precipitation.textContent = `${data.current.precipitation}%`;
  if (pressure) pressure.textContent = `${data.current.pressure} hPa`;
  if (aqiValue) aqiValue.textContent = data.current.aqi;
  if (aqiLevel) {
    aqiLevel.textContent = data.current.aqiLevel;
    aqiLevel.className = 'aqi-indicator ';
    if (data.current.aqi < 50) aqiLevel.classList.add('aqi-good');
    else if (data.current.aqi < 100) aqiLevel.classList.add('aqi-moderate');
    else if (data.current.aqi < 150) aqiLevel.classList.add('aqi-unhealthy');
    else if (data.current.aqi < 200) aqiLevel.classList.add('aqi-very-unhealthy');
    else aqiLevel.classList.add('aqi-hazardous');
  }
  if (dewPoint) dewPoint.textContent = `${data.current.dewPoint}Â°C`;
  if (cloudCover) cloudCover.textContent = `${data.current.cloudCover}%`;

  // æ›´æ–°å¤©æ°”å›¾æ ‡
  const weatherIcon = document.getElementById('weather-icon');
  if (weatherIcon) {
    weatherIcon.className = `fa ${getWeatherIcon(data.current.desc)} weather-icon`;
  }

  // æ›´æ–°å¤©æ°”é¢„æŠ¥
  const forecastContainer = document.getElementById('forecast-container');
  if (forecastContainer) {
    forecastContainer.innerHTML = '';
    
    data.forecast.forEach(day => {
      const forecastDay = document.createElement('div');
      forecastDay.className = 'forecast-day';
      forecastDay.innerHTML = `
        <div class="forecast-date">${day.date}</div>
        <div class="forecast-weekday">${day.weekDay}</div>
        <i class="fa ${day.icon} forecast-icon"></i>
        <div class="forecast-temp">${day.temp}</div>
        <div class="forecast-desc">${day.desc}</div>
      `;
      forecastContainer.appendChild(forecastDay);
    });
  }
}

// æ ¹æ®å¤©æ°”æè¿°è·å–å›¾æ ‡
function getWeatherIcon(desc) {
  const iconMap = {
    'æ™´': 'fa-sun-o',
    'å¤šäº‘': 'fa-cloud',
    'é˜´': 'fa-cloud',
    'å°é›¨': 'fa-tint',
    'ä¸­é›¨': 'fa-tint',
    'å¤§é›¨': 'fa-tint',
    'é˜µé›¨': 'fa-tint',
    'é›·é˜µé›¨': 'fa-bolt',
    'å°é›ª': 'fa-snowflake-o',
    'ä¸­é›ª': 'fa-snowflake-o',
    'å¤§é›ª': 'fa-snowflake-o',
    'é›¾': 'fa-cloud'
  };
  return iconMap[desc] || 'fa-cloud';
}

// åˆå§‹åŒ–å›¾è¡¨
window.addEventListener('DOMContentLoaded', () => {
  // æ¸©åº¦æ¹¿åº¦è¶‹åŠ¿å›¾
  const tempHumidityCtx = document.getElementById('tempHumidityChart');
  if (tempHumidityCtx) {
    tempHumidityChart = new Chart(tempHumidityCtx.getContext('2d'), {
      type: 'line',
      data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'ç°åœ¨'],
        datasets: [
          {
            label: 'æ¸©åº¦ (Â°C)',
            data: [5.5, 4.8, 7.3, 12.7, 13.5, 10.2, 9.8],
            borderColor: '#EF4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y'
          },
          {
            label: 'æ¹¿åº¦ (%)',
            data: [72, 75, 68, 55, 52, 60, 62],
            borderColor: '#3B82F6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: {
              display: true,
              text: 'æ¸©åº¦ (Â°C)'
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            title: {
              display: true,
              text: 'æ¹¿åº¦ (%)'
            },
            grid: {
              drawOnChartArea: false
            }
          }
        }
      }
    });
  }

  // å…‰ç…§è¶‹åŠ¿å›¾
  const lightCtx = document.getElementById('lightChart');
  if (lightCtx) {
    lightChart = new Chart(lightCtx.getContext('2d'), {
      type: 'line',
      data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'ç°åœ¨'],
        datasets: [
          {
            label: 'å…‰ç…§å¼ºåº¦ (åƒlx)',
            data: [0, 0, 3.2, 5.8, 5.5, 2.2, 0.5],
            borderColor: '#EAB308',
            backgroundColor: 'rgba(234, 179, 8, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: {
              display: true,
              text: 'å…‰ç…§å¼ºåº¦ (åƒlx)'
            }
          }
        }
      }
    });
  }
  
  // ä¸ºæ°”å€™åˆ†æé“¾æ¥æ·»åŠ ç‚¹å‡»äº‹ä»¶
  document.querySelectorAll('a[href="/climate-report"]').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      showClimateReport();
    });
  });
  
  // åˆå§‹åŒ–äº¤äº’åŠŸèƒ½
  initInteractiveFeatures();
  // åˆå§‹åŒ–ä¼ æ„Ÿå™¨ç›‘æ§
  initSensorMonitoring();
  // åˆå§‹åŒ–ç§æ¤å»ºè®®æ¨¡å—
  initPlantingAdvice();
  
  // åˆå§‹åŒ–æˆ·å¤–ç¯å¢ƒæ•°æ®ä¸ºæ¨¡æ‹Ÿæ•°æ®
  initializeOutdoorEnvironment();
});

// åˆå§‹åŒ–æˆ·å¤–ç¯å¢ƒæ•°æ®ä¸ºæ¨¡æ‹Ÿæ•°æ®
function initializeOutdoorEnvironment() {
  // è®¾ç½®æˆ·å¤–ç©ºæ°”æ¸©åº¦ä¸ºå›ºå®šå€¼ -1.00Â°C
  const outdoorTempElement = document.getElementById('outdoor-temp');
  if (outdoorTempElement) {
    outdoorTempElement.textContent = '-1.00Â°C';
  }
  
  // è®¾ç½®æˆ·å¤–ç©ºæ°”æ¹¿åº¦ä¸ºå›ºå®šå€¼ 52.16%
  const outdoorHumidityElement = document.getElementById('outdoor-humidity');
  if (outdoorHumidityElement) {
    outdoorHumidityElement.textContent = '52.16%';
  }
  
  // è®¾ç½®æ¸©åº¦è¿›åº¦æ¡ä¸º15%
  const tempProgressBar = document.querySelector('#outdoor .bg-red-500');
  if (tempProgressBar) {
    tempProgressBar.style.width = '15%';
  }
  
  // è®¾ç½®æ¹¿åº¦è¿›åº¦æ¡ä¸º52.16%
  const humidityProgressBar = document.querySelector('#outdoor .bg-blue-500');
  if (humidityProgressBar) {
    humidityProgressBar.style.width = '52.16%';
  }
}

// æ—¶é—´èŒƒå›´åˆ‡æ¢
function changeTimeRange(range) {
  // æ›´æ–°æŒ‰é’®çŠ¶æ€
  document.querySelectorAll('#trends button').forEach(btn => {
    btn.classList.remove('bg-primary', 'text-white');
    btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
  });

  event.target.classList.add('bg-primary', 'text-white');
  event.target.classList.remove('bg-gray-200', 'hover:bg-gray-300');

  // æ ¹æ®æ—¶é—´èŒƒå›´æ›´æ–°å›¾è¡¨æ•°æ®
  let labels, tempData, humidityData, lightData;
  switch(range) {
    case 'day':
      labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'ç°åœ¨'];
      tempData = [5.5, 4.8, 7.3, 12.7, 13.5, 10.2, 9.8];
      humidityData = [72, 75, 68, 55, 52, 60, 62];
      lightData = [0, 0, 3.2, 5.8, 5.5, 2.2, 0.5];
      break;
    case 'week':
      labels = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
      tempData = [9.3, 8.5, 7.8, 10.2, 11.1, 9.7, 8.9];
      humidityData = [68, 65, 62, 58, 55, 60, 63];
      lightData = [4.2, 4.8, 5.3, 5.7, 5.1, 4.5, 3.9];
      break;
    case 'month':
      labels = ['1æ—¥', '5æ—¥', '10æ—¥', '15æ—¥', '20æ—¥', '25æ—¥', '30æ—¥'];
      tempData = [12.5, 10.3, 8.8, 7.2, 6.5, 5.8, 4.2];
      humidityData = [70, 68, 65, 62, 58, 60, 63];
      lightData = [5.8, 5.2, 4.8, 4.3, 3.7, 3.2, 2.7];
      break;
    case 'year':
      labels = ['1æœˆ', '3æœˆ', '5æœˆ', '7æœˆ', '9æœˆ', '11æœˆ', '12æœˆ'];
      tempData = [2.2, 8.5, 18.3, 26.8, 22.5, 8.8, 3.3];
      humidityData = [75, 70, 65, 60, 62, 68, 72];
      lightData = [3.5, 4.8, 6.2, 7.5, 6.8, 4.5, 3.2];
      break;
  }

  // æ›´æ–°å›¾è¡¨
  if (tempHumidityChart) {
    tempHumidityChart.data.labels = labels;
    tempHumidityChart.data.datasets[0].data = tempData;
    tempHumidityChart.data.datasets[1].data = humidityData;
    tempHumidityChart.update();
  }

  if (lightChart) {
    lightChart.data.labels = labels;
    lightChart.data.datasets[0].data = lightData;
    lightChart.update();
  }
}

// å¹³æ»‘æ»šåŠ¨
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const targetId = this.getAttribute('href');
    const targetElement = document.querySelector(targetId);
    if (targetElement) {
      window.scrollTo({
        top: targetElement.offsetTop - 80,
        behavior: 'smooth'
      });
      // å…³é—­ç§»åŠ¨èœå•ï¼ˆå¦‚æœæ‰“å¼€ï¼‰
      const mobileMenu = document.getElementById('mobileMenu');
      if (mobileMenu) mobileMenu.classList.add('hidden');
    }
  });
});

// å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
window.addEventListener('scroll', function() {
  const header = document.querySelector('header');
  if (header) {
    if (window.scrollY > 50) {
      header.classList.add('py-2');
      header.classList.remove('py-3');
    } else {
      header.classList.add('py-3');
      header.classList.remove('py-2');
    }
  }
});

// å…¨å±€å˜é‡
let refreshBtn, loading, error, autoRefreshStatus, autoRefreshTimer;
let sensorDataHistory = {
  temperature: [],
  humidity: [],
  light: []
};
const MAX_HISTORY_LENGTH = 20;

// åœŸå£¤æ¹¿åº¦æ¨¡æ‹Ÿæ•°æ®
let currentSoilMoisture = 52.0; // åˆå§‹å€¼

// ç”ŸæˆåœŸå£¤æ¹¿åº¦æ¨¡æ‹Ÿæ•°æ®ï¼ˆ40%-60%ä¹‹é—´ï¼‰
function generateSoilMoistureData() {
  // åœ¨ä¸Šæ¬¡å€¼çš„åŸºç¡€ä¸Šè¿›è¡Œå¾®å°å˜åŒ– (Â±0.5% åˆ° Â±1.5%)
  const change = (Math.random() * 2) - 1; // -1 åˆ° 1
  const newValue = currentSoilMoisture + change;
  
  // ç¡®ä¿åœ¨40-60%èŒƒå›´å†…
  if (newValue < 40) {
    currentSoilMoisture = 40;
  } else if (newValue > 60) {
    currentSoilMoisture = 60;
  } else {
    currentSoilMoisture = newValue;
  }
  
  return Math.round(currentSoilMoisture * 100) / 100; // ä¿ç•™ä¸¤ä½å°æ•°
}

// æ›´æ–°ä¼ æ„Ÿå™¨å›¾è¡¨æ•°æ®
function updateSensorCharts(data) {
  const sensors = data.sensors || {};
  
  // ç¡®ä¿å›¾è¡¨å·²åˆå§‹åŒ–
  if (typeof tempHumidityChart !== 'undefined' && typeof lightChart !== 'undefined') {
    
    // è·å–å½“å‰æ—¶é—´æ ‡ç­¾
    const now = new Date();
    const timeLabel = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    
    // æ›´æ–°æ¸©åº¦å’Œæ¹¿åº¦å›¾è¡¨
    if (sensors.temperature && sensors.humidity) {
      const temp = sensors.temperature.value;
      const humidity = sensors.humidity.value;
      
      // ä¿å­˜åˆ°å†å²æ•°æ®
      sensorDataHistory.temperature.push(temp);
      sensorDataHistory.humidity.push(humidity);
      
      // ä¿æŒå†å²æ•°æ®é•¿åº¦
      if (sensorDataHistory.temperature.length > MAX_HISTORY_LENGTH) {
        sensorDataHistory.temperature.shift();
        sensorDataHistory.humidity.shift();
        tempHumidityChart.data.labels.shift();
      }
      
      // æ›´æ–°å›¾è¡¨æ ‡ç­¾å’Œæ•°æ®
      if (sensorDataHistory.temperature.length > tempHumidityChart.data.labels.length) {
        tempHumidityChart.data.labels.push(timeLabel);
      }
      
      tempHumidityChart.data.datasets[0].data = [...sensorDataHistory.temperature];
      tempHumidityChart.data.datasets[1].data = [...sensorDataHistory.humidity];
      
      // æ›´æ–°å›¾è¡¨
      tempHumidityChart.update('none');
    }
    
    // æ›´æ–°å…‰ç…§å›¾è¡¨
    if (sensors.light) {
      const light = sensors.light.value / 1000; // è½¬æ¢ä¸ºåƒlx
      
      // ä¿å­˜åˆ°å†å²æ•°æ®
      sensorDataHistory.light.push(light);
      
      // ä¿æŒå†å²æ•°æ®é•¿åº¦
      if (sensorDataHistory.light.length > MAX_HISTORY_LENGTH) {
        sensorDataHistory.light.shift();
        lightChart.data.labels.shift();
      }
      
      // æ›´æ–°å›¾è¡¨æ ‡ç­¾å’Œæ•°æ®
      if (sensorDataHistory.light.length > lightChart.data.labels.length) {
        lightChart.data.labels.push(timeLabel);
      }
      
      lightChart.data.datasets[0].data = [...sensorDataHistory.light];
      
      // æ›´æ–°å›¾è¡¨
      lightChart.update('none');
    }
  }
}

// è·å–ä¼ æ„Ÿå™¨æ•°æ®å‡½æ•° - è°ƒç”¨çœŸå®çš„åç«¯API
function fetchSensorData() {
  if (loading) loading.style.display = 'block';
  if (error) error.style.display = 'none';

  // è°ƒç”¨çœŸå®çš„åç«¯API
  fetch('/api/real-time-data')
    .then(response => {
      if (!response.ok) {
        throw new Error('ç½‘ç»œå“åº”ä¸æ­£å¸¸');
      }
      return response.json();
    })
    .then(result => {
      if (result.success) {
        const data = result.data;
        console.log('è·å–åˆ°ä¼ æ„Ÿå™¨æ•°æ®:', data);
        updateDashboard(data);
        updateSensorCharts(data);
        if (loading) loading.style.display = 'none';
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        const now = new Date();
        const lastUpdate = document.getElementById('lastUpdate');
        const lastSensorUpdate = document.getElementById('lastSensorUpdate');
        if (lastUpdate) lastUpdate.textContent = 'åˆšåˆš';
        if (lastSensorUpdate) lastSensorUpdate.textContent = now.toLocaleTimeString('zh-CN');
        
        // è·å–ç³»ç»ŸçŠ¶æ€
        fetchSystemStatus();
      } else {
        throw new Error('æ•°æ®è·å–å¤±è´¥');
      }
    })
    .catch(err => {
      console.error('è·å–ä¼ æ„Ÿå™¨æ•°æ®å¤±è´¥:', err);
      if (loading) loading.style.display = 'none';
      if (error) {
        error.textContent = "è·å–ä¼ æ„Ÿå™¨æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"; 
        error.style.display = 'block';
      }
      // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
      updateDashboardWithSimulatedData();
    });
}

// ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ›´æ–°ä»ªè¡¨æ¿
function updateDashboardWithSimulatedData() {
  const simulatedData = {
    timestamp: new Date().toISOString(),
    sensors: {
      temperature: {
        value: 25.0 + (Math.random() * 4 - 2), // 23-27Â°Cä¹‹é—´
        unit: 'Â°C',
        status: 'normal',
        raw_value: null,
        simulated: true
      },
      humidity: {
        value: 60.0 + (Math.random() * 10 - 5), // 55-65%ä¹‹é—´
        unit: '%',
        status: 'normal',
        raw_value: null,
        simulated: true
      },
      light: {
        value: 5000 + (Math.random() * 2000 - 1000), // 4000-6000lxä¹‹é—´
        unit: 'lx',
        status: 'normal',
        raw_value: null,
        simulated: true
      },
      soil_moisture: {
        value: generateSoilMoistureData(), // ä½¿ç”¨æ¨¡æ‹ŸåœŸå£¤æ¹¿åº¦æ•°æ®
        unit: '%',
        status: 'normal',
        raw_value: null,
        simulated: true
      }
    },
    status: 'simulated',
    message: 'ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®'
  };
  
  updateDashboard(simulatedData);
  updateSensorCharts(simulatedData);
  
  // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
  const now = new Date();
  const lastUpdate = document.getElementById('lastUpdate');
  const lastSensorUpdate = document.getElementById('lastSensorUpdate');
  if (lastUpdate) lastUpdate.textContent = 'åˆšåˆš';
  if (lastSensorUpdate) lastSensorUpdate.textContent = now.toLocaleTimeString('zh-CN');
}

// è·å–ç³»ç»ŸçŠ¶æ€
function fetchSystemStatus() {
  fetch('/api/system-status')
    .then(response => response.json())
    .then(result => {
      if (result.success) {
        const status = result.status;
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º
        updateSystemStatusDisplay(status);
      }
    })
    .catch(err => {
      console.error('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥:', err);
      // ä½¿ç”¨æ¨¡æ‹Ÿç³»ç»ŸçŠ¶æ€
      updateSystemStatusDisplay({
        online_sensors: '3/3',
        data_quality: '98%',
        update_frequency: '5ç§’',
        alert_status: 'normal',
        alert_message: 'ç³»ç»Ÿè¿è¡Œæ­£å¸¸',
        last_update: new Date().toISOString()
      });
    });
}

// æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º
function updateSystemStatusDisplay(status) {
  // æ›´æ–°åœ¨çº¿ä¼ æ„Ÿå™¨
  const onlineSensors = document.getElementById('online-sensors');
  const onlineSensorsStat = document.getElementById('online-sensors-stat');
  if (onlineSensors) onlineSensors.textContent = status.online_sensors || '3/3';
  if (onlineSensorsStat) onlineSensorsStat.textContent = status.online_sensors || '3/3';
  
  // æ›´æ–°æ•°æ®è´¨é‡
  const dataQuality = document.getElementById('data-quality');
  if (dataQuality) dataQuality.textContent = status.data_quality || '98%';
  
  // æ›´æ–°æ›´æ–°é¢‘ç‡
  const updateFrequency = document.getElementById('update-frequency');
  if (updateFrequency) updateFrequency.textContent = status.update_frequency || '5ç§’';
  
  // æ›´æ–°å‘Šè­¦çŠ¶æ€
  const alertCount = document.getElementById('alert-count');
  const alertMessage = document.getElementById('alert-message');
  if (alertCount) alertCount.textContent = status.alert_status === 'warning' ? '1' : '0';
  if (alertMessage) {
    alertMessage.textContent = status.alert_message || 'ç³»ç»Ÿè¿è¡Œæ­£å¸¸';
    if (status.alert_status === 'warning') {
      alertMessage.className = 'text-sm text-yellow-500';
    } else {
      alertMessage.className = 'text-sm text-green-500';
    }
  }
  
  // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
  if (status.last_update) {
    const date = new Date(status.last_update);
    const lastUpdate = document.getElementById('lastUpdate');
    if (lastUpdate) lastUpdate.textContent = date.toLocaleTimeString('zh-CN');
  }
}

// æ›´æ–°ä»ªè¡¨æ¿æ•°æ® - ä¿®å¤ç‰ˆ
function updateDashboard(data) {
  console.log('ä¼ æ„Ÿå™¨æ•°æ®:', data);

  const sensors = data.sensors || {};
  
  // å¤„ç†å…‰ç…§ä¼ æ„Ÿå™¨æ•°æ®
  if (sensors.light) {
    const lightValue = sensors.light.value;
    const lightElement = document.getElementById('light-value');
    if (lightElement) {
      // ç¡®ä¿æ˜¾ç¤ºä¸¤ä½å°æ•°
      lightElement.textContent = lightValue.toFixed(2);
      lightElement.classList.add('data-update');
      setTimeout(() => lightElement.classList.remove('data-update'), 500);
    }
    
    // æ›´æ–°å…‰ç…§çŠ¶æ€æŒ‡ç¤º
    const lightStatus = document.getElementById('light-status');
    if (lightStatus) {
      if (lightValue < 1000) {
        lightStatus.textContent = 'è¿‡ä½';
        lightStatus.className = 'env-card-status status-critical';
      } else if (lightValue > 10000) {
        lightStatus.textContent = 'è¿‡é«˜';
        lightStatus.className = 'env-card-status status-warning';
      } else {
        lightStatus.textContent = 'æ­£å¸¸';
        lightStatus.className = 'env-card-status status-good';
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStatistics('light', lightValue);
  }

  // å¤„ç†æ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ®
  if (sensors.temperature) {
    const tempValue = sensors.temperature.value;
    const tempElement = document.getElementById('temp-value');
    if (tempElement) {
      // ç¡®ä¿æ˜¾ç¤ºä¸¤ä½å°æ•°
      tempElement.textContent = tempValue.toFixed(2);
      tempElement.classList.add('data-update');
      setTimeout(() => tempElement.classList.remove('data-update'), 500);
    }
    
    // åŒæ—¶æ›´æ–°æ¦‚è§ˆå’Œæˆ·å¤–æ¸©åº¦æ•°æ®
    const avgTemp = document.getElementById('avg-temp');
    const outdoorTemp = document.getElementById('outdoor-temp');
    if (avgTemp) avgTemp.textContent = tempValue.toFixed(2) + 'Â°C';
    if (outdoorTemp) outdoorTemp.textContent = tempValue.toFixed(2) + 'Â°C';
    
    // æ›´æ–°æ¸©åº¦çŠ¶æ€æŒ‡ç¤º
    const tempStatus = document.getElementById('temp-status');
    if (tempStatus) {
      if (tempValue < 10) {
        tempStatus.textContent = 'è¿‡ä½';
        tempStatus.className = 'env-card-status status-warning';
      } else if (tempValue > 35) {
        tempStatus.textContent = 'è¿‡é«˜';
        tempStatus.className = 'env-card-status status-critical';
      } else {
        tempStatus.textContent = 'é€‚å®œ';
        tempStatus.className = 'env-card-status status-good';
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStatistics('temperature', tempValue);
  }

  // å¤„ç†æ¹¿åº¦ä¼ æ„Ÿå™¨æ•°æ®
  if (sensors.humidity) {
    const humidityValue = sensors.humidity.value;
    const humidityElement = document.getElementById('humidity-value');
    if (humidityElement) {
      // ç¡®ä¿æ˜¾ç¤ºä¸¤ä½å°æ•°
      humidityElement.textContent = humidityValue.toFixed(2);
      humidityElement.classList.add('data-update');
      setTimeout(() => humidityElement.classList.remove('data-update'), 500);
    }
    
    // åŒæ—¶æ›´æ–°æ¦‚è§ˆå’Œæˆ·å¤–æ¹¿åº¦æ•°æ®
    const avgHumidity = document.getElementById('avg-humidity');
    const outdoorHumidity = document.getElementById('outdoor-humidity');
    if (avgHumidity) avgHumidity.textContent = humidityValue.toFixed(2) + '%';
    if (outdoorHumidity) outdoorHumidity.textContent = humidityValue.toFixed(2) + '%';
    
    // æ›´æ–°æ¹¿åº¦çŠ¶æ€æŒ‡ç¤º
    const humidityStatus = document.getElementById('humidity-status');
    if (humidityStatus) {
      if (humidityValue < 30) {
        humidityStatus.textContent = 'è¿‡ä½';
        humidityStatus.className = 'env-card-status status-critical';
      } else if (humidityValue > 80) {
        humidityStatus.textContent = 'è¿‡é«˜';
        humidityStatus.className = 'env-card-status status-warning';
      } else {
        humidityStatus.textContent = 'é€‚å®œ';
        humidityStatus.className = 'env-card-status status-good';
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStatistics('humidity', humidityValue);
  }
  
  // å¤„ç†åœŸå£¤æ¹¿åº¦æ•°æ®ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œä¸ä»APIè·å–ï¼‰
  const soilMoistureValue = generateSoilMoistureData();
  // æ›´æ–°æ¦‚è§ˆä¸­çš„åœŸå£¤æ¹¿åº¦æ•°æ®
  const avgSoilMoisture = document.getElementById('avg-soil-moisture');
  if (avgSoilMoisture) {
    avgSoilMoisture.textContent = soilMoistureValue.toFixed(2) + ' %';
    avgSoilMoisture.classList.add('data-update');
    setTimeout(() => avgSoilMoisture.classList.remove('data-update'), 500);
  }
  
  // æ›´æ–°æˆ·å¤–ç¯å¢ƒä¸­çš„åœŸå£¤æ¹¿åº¦æ•°æ®
  const outdoorSoilMoisture = document.getElementById('outdoor-soil-moisture');
  if (outdoorSoilMoisture) {
    outdoorSoilMoisture.textContent = soilMoistureValue.toFixed(2) + ' %';
    outdoorSoilMoisture.classList.add('data-update');
    setTimeout(() => outdoorSoilMoisture.classList.remove('data-update'), 500);
  }
  
  // æ›´æ–°æ—¶é—´æˆ³
  const timestampElement = document.getElementById('lastUpdate');
  if (timestampElement && data.timestamp) {
    const date = new Date(data.timestamp);
    timestampElement.textContent = date.toLocaleTimeString('zh-CN');
  }
}

// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
function updateStatistics(type, value) {
  if (type === 'temperature') {
    const maxTemp = document.getElementById('max-temp');
    const minTemp = document.getElementById('min-temp');
    const avgTempStat = document.getElementById('avg-temp-stat');
    
    if (maxTemp) maxTemp.textContent = value.toFixed(2) + 'Â°C';
    if (minTemp) minTemp.textContent = value.toFixed(2) + 'Â°C';
    if (avgTempStat) avgTempStat.textContent = value.toFixed(2) + 'Â°C';
  } else if (type === 'humidity') {
    const maxHumidity = document.getElementById('max-humidity');
    const minHumidity = document.getElementById('min-humidity');
    const avgHumidityStat = document.getElementById('avg-humidity-stat');
    
    if (maxHumidity) maxHumidity.textContent = value.toFixed(2) + '%';
    if (minHumidity) minHumidity.textContent = value.toFixed(2) + '%';
    if (avgHumidityStat) avgHumidityStat.textContent = value.toFixed(2) + '%';
  } else if (type === 'light') {
    const maxLight = document.getElementById('max-light');
    const minLight = document.getElementById('min-light');
    const avgLightStat = document.getElementById('avg-light-stat');
    
    if (maxLight) maxLight.textContent = value.toFixed(2) + ' lx';
    if (minLight) minLight.textContent = value.toFixed(2) + ' lx';
    if (avgLightStat) avgLightStat.textContent = value.toFixed(2) + ' lx';
  }
}

// ä¼ æ„Ÿå™¨æ•°æ®ç›‘æ§åŠŸèƒ½
function initSensorMonitoring() {
  refreshBtn = document.getElementById('refresh-sensor-btn');
  loading = document.getElementById('sensor-loading');
  error = document.getElementById('sensor-error');
  autoRefreshStatus = document.getElementById('auto-refresh-status');

  // è‡ªåŠ¨åˆ·æ–°å®šæ—¶å™¨
  autoRefreshTimer = null;

  // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
  function startAutoRefresh() {
    // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œä¸Pythonåç«¯åŒæ­¥
    autoRefreshTimer = setInterval(fetchSensorData, 5000);
    if (autoRefreshStatus) {
      autoRefreshStatus.innerHTML = '<i class="fa fa-clock-o text-xs mr-1"></i> è‡ªåŠ¨åˆ·æ–°: å¼€å¯';
      autoRefreshStatus.classList.remove('bg-gray-100', 'text-gray-800');
      autoRefreshStatus.classList.add('bg-blue-100', 'text-blue-800');
    }
  }

  // åœæ­¢è‡ªåŠ¨åˆ·æ–°
  function stopAutoRefresh() {
    if (autoRefreshTimer) {
      clearInterval(autoRefreshTimer);
      autoRefreshTimer = null;
    }
    if (autoRefreshStatus) {
      autoRefreshStatus.innerHTML = '<i class="fa fa-clock-o text-xs mr-1"></i> è‡ªåŠ¨åˆ·æ–°: å…³é—­';
      autoRefreshStatus.classList.remove('bg-blue-100', 'text-blue-800');
      autoRefreshStatus.classList.add('bg-gray-100', 'text-gray-800');
    }
  }

  // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
  if (autoRefreshStatus) {
    autoRefreshStatus.addEventListener('click', function() {
      if (autoRefreshTimer) {
        stopAutoRefresh();
      } else {
        startAutoRefresh();
      }
    });
  }

  // åˆå§‹åŠ è½½æ•°æ®å¹¶å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
  fetchSensorData();
  startAutoRefresh();

  // åˆ·æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  if (refreshBtn) {
    refreshBtn.addEventListener('click', function() {
      // æ·»åŠ åˆ·æ–°åŠ¨ç”»
      this.querySelector('i').classList.add('refresh-animation');
      setTimeout(() => {
        this.querySelector('i').classList.remove('refresh-animation');
      }, 500);
      fetchSensorData();
    });
  }
}

// ç§æ¤å»ºè®®ç›¸å…³å˜é‡
let currentCrop = 'tomato';
let currentGrowthStage = 'seedling';
let cropDatabase = {
  tomato: {
    name: 'ç•ªèŒ„',
    optimalTemp: { min: 18, max: 28 },
    optimalHumidity: { min: 60, max: 70 },
    optimalSoilMoisture: { min: 65, max: 75 },
    optimalLight: { min: 30000, max: 50000 },
    stages: {
      seedling: { duration: 25, temp: { min: 20, max: 25 }, humidity: { min: 65, max: 75 } },
      vegetative: { duration: 30, temp: { min: 22, max: 28 }, humidity: { min: 60, max: 70 } },
      flowering: { duration: 20, temp: { min: 20, max: 26 }, humidity: { min: 55, max: 65 } },
      fruiting: { duration: 40, temp: { min: 18, max: 24 }, humidity: { min: 50, max: 60 } }
    }
  },
  cucumber: {
    name: 'é»„ç“œ',
    optimalTemp: { min: 20, max: 30 },
    optimalHumidity: { min: 70, max: 80 },
    optimalSoilMoisture: { min: 70, max: 80 },
    optimalLight: { min: 25000, max: 45000 }
  },
  lettuce: {
    name: 'ç”Ÿèœ',
    optimalTemp: { min: 15, max: 22 },
    optimalHumidity: { min: 60, max: 70 },
    optimalSoilMoisture: { min: 60, max: 70 },
    optimalLight: { min: 20000, max: 35000 }
  },
  strawberry: {
    name: 'è‰è“',
    optimalTemp: { min: 15, max: 25 },
    optimalHumidity: { min: 60, max: 70 },
    optimalSoilMoisture: { min: 65, max: 75 },
    optimalLight: { min: 25000, max: 40000 }
  },
  pepper: {
    name: 'è¾£æ¤’',
    optimalTemp: { min: 22, max: 30 },
    optimalHumidity: { min: 55, max: 65 },
    optimalSoilMoisture: { min: 60, max: 70 },
    optimalLight: { min: 30000, max: 50000 }
  }
};

// é€‰æ‹©ä½œç‰©ç±»å‹
function selectCropType(crop) {
  currentCrop = crop;
  
  // æ›´æ–°æŒ‰é’®çŠ¶æ€
  document.querySelectorAll('.crop-type-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰è¡¨å•
  const customForm = document.getElementById('custom-crop-form');
  if (crop === 'custom') {
    customForm.classList.remove('hidden');
  } else {
    customForm.classList.add('hidden');
    // ç”Ÿæˆç§æ¤å»ºè®®
    generatePlantingAdvice();
  }
}

// é€‰æ‹©ç”Ÿé•¿é˜¶æ®µ
function selectGrowthStage(stage) {
  currentGrowthStage = stage;
  
  // æ›´æ–°æŒ‰é’®çŠ¶æ€
  document.querySelectorAll('.growth-stage-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // æ›´æ–°ç§æ¤å»ºè®®
  generatePlantingAdvice();
}

// ä¿å­˜è‡ªå®šä¹‰ä½œç‰©
function saveCustomCrop() {
  const name = document.getElementById('crop-name').value;
  const tempRange = document.getElementById('optimal-temp').value;
  const humidityRange = document.getElementById('optimal-humidity').value;
  
  if (!name || !tempRange || !humidityRange) {
    alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
    return;
  }
  
  // æ·»åŠ åˆ°æ•°æ®åº“
  cropDatabase.custom = {
    name: name,
    optimalTemp: parseRange(tempRange),
    optimalHumidity: parseRange(humidityRange),
    optimalSoilMoisture: { min: 60, max: 75 },
    optimalLight: { min: 25000, max: 40000 }
  };
  
  currentCrop = 'custom';
  generatePlantingAdvice();
}

// è§£æèŒƒå›´å­—ç¬¦ä¸²
function parseRange(rangeStr) {
  const parts = rangeStr.split('-').map(p => parseInt(p.trim()));
  return { min: parts[0], max: parts[1] || parts[0] };
}

// ç”Ÿæˆç§æ¤å»ºè®®
function generatePlantingAdvice() {
  // è·å–å½“å‰ç¯å¢ƒæ•°æ®
  const currentTemp = parseFloat(document.getElementById('outdoor-temp').textContent) || 
                     parseFloat(document.getElementById('temp-value').textContent) || 20;
  const currentHumidity = parseFloat(document.getElementById('outdoor-humidity').textContent) || 
                         parseFloat(document.getElementById('humidity-value').textContent) || 65;
  const currentSoilMoisture = parseFloat(document.getElementById('outdoor-soil-moisture').textContent) || 52;
  const currentLight = parseFloat(document.getElementById('light-value').textContent) || 30000;
  
  // æ›´æ–°ç¯å¢ƒæ•°æ®æ˜¾ç¤ºï¼Œç¡®ä¿ä¸¤ä½å°æ•°
  document.getElementById('current-env-temp').textContent = currentTemp.toFixed(2) + 'Â°C';
  document.getElementById('current-env-humidity').textContent = currentHumidity.toFixed(2) + '%';
  document.getElementById('current-env-soil').textContent = currentSoilMoisture.toFixed(2) + '%';
  document.getElementById('current-env-light').textContent = Math.round(currentLight) + ' lx'; // å…‰ç…§é€šå¸¸å–æ•´
  
  // è·å–ä½œç‰©æ•°æ®
  const cropData = cropDatabase[currentCrop];
  if (!cropData) return;
  
  // è®¡ç®—é€‚å®œåº¦åˆ†æ•°
  const suitabilityScore = calculateSuitabilityScore(currentTemp, currentHumidity, currentSoilMoisture, currentLight, cropData);
  document.getElementById('suitability-score').textContent = suitabilityScore.toFixed(2) + '%';
  document.getElementById('suitability-bar').style.width = suitabilityScore + '%';
  
  // è®¾ç½®åˆ†æ•°é¢œè‰²
  const scoreElement = document.getElementById('suitability-score');
  scoreElement.className = 'text-sm px-3 py-1 rounded-full ';
  if (suitabilityScore >= 80) {
    scoreElement.classList.add('bg-green-100', 'text-green-800');
  } else if (suitabilityScore >= 60) {
    scoreElement.classList.add('bg-yellow-100', 'text-yellow-800');
  } else {
    scoreElement.classList.add('bg-red-100', 'text-red-800');
  }
  
  // ç”Ÿæˆè¯¦ç»†å»ºè®®
  generateDetailedAdvice(currentTemp, currentHumidity, currentSoilMoisture, currentLight, cropData);
  
  // ç”Ÿæˆç§æ¤è®¡åˆ’
  generatePlantingSchedule();
}

// è®¡ç®—é€‚å®œåº¦åˆ†æ•°
function calculateSuitabilityScore(temp, humidity, soilMoisture, light, cropData) {
  let score = 0;
  let totalWeight = 0;
  
  // æ¸©åº¦åˆ†æ•° (æƒé‡30%)
  const tempScore = calculateParameterScore(temp, cropData.optimalTemp);
  score += tempScore * 0.3;
  totalWeight += 0.3;
  
  // æ¹¿åº¦åˆ†æ•° (æƒé‡20%)
  const humidityScore = calculateParameterScore(humidity, cropData.optimalHumidity);
  score += humidityScore * 0.2;
  totalWeight += 0.2;
  
  // åœŸå£¤æ¹¿åº¦åˆ†æ•° (æƒé‡25%)
  const soilScore = calculateParameterScore(soilMoisture, cropData.optimalSoilMoisture);
  score += soilScore * 0.25;
  totalWeight += 0.25;
  
  // å…‰ç…§åˆ†æ•° (æƒé‡25%)
  const lightScore = calculateParameterScore(light, cropData.optimalLight);
  score += lightScore * 0.25;
  totalWeight += 0.25;
  
  return Math.round(score / totalWeight);
}

// è®¡ç®—å‚æ•°åˆ†æ•°
function calculateParameterScore(value, optimalRange) {
  if (value >= optimalRange.min && value <= optimalRange.max) {
    return 100;
  } else if (value < optimalRange.min) {
    const diff = optimalRange.min - value;
    const maxDiff = optimalRange.min * 0.5;
    return Math.max(0, 100 - (diff / maxDiff * 100));
  } else {
    const diff = value - optimalRange.max;
    const maxDiff = optimalRange.max * 0.5;
    return Math.max(0, 100 - (diff / maxDiff * 100));
  }
}

// ç”Ÿæˆè¯¦ç»†å»ºè®®
function generateDetailedAdvice(temp, humidity, soilMoisture, light, cropData) {
  const cropName = cropData.name;
  const warningAlert = document.getElementById('warning-alert');
  warningAlert.classList.add('hidden');
  
  // æ¸©åº¦å»ºè®® - ç¡®ä¿æ˜¾ç¤ºä¸¤ä½å°æ•°
  let tempAdvice = '';
  if (temp < cropData.optimalTemp.min) {
    tempAdvice = `å½“å‰æ¸©åº¦${temp.toFixed(2)}Â°Cä½äº${cropName}é€‚å®œæ¸©åº¦(${cropData.optimalTemp.min}-${cropData.optimalTemp.max}Â°C)ã€‚å»ºè®®ï¼šå¼€å¯åŠ æ¸©è®¾å¤‡ï¼Œå…³é—­éƒ¨åˆ†é€šé£å£ï¼Œè¦†ç›–ä¿æ¸©è†œã€‚`;
    showWarning(`æ¸©åº¦è¿‡ä½ï¼Œå¯èƒ½å½±å“${cropName}ç”Ÿé•¿ï¼`);
  } else if (temp > cropData.optimalTemp.max) {
    tempAdvice = `å½“å‰æ¸©åº¦${temp.toFixed(2)}Â°Cé«˜äº${cropName}é€‚å®œæ¸©åº¦ã€‚å»ºè®®ï¼šå¼€å¯é€šé£ç³»ç»Ÿï¼Œä½¿ç”¨é®é˜³ç½‘ï¼Œé€‚å½“å–·æ°´é™æ¸©ã€‚`;
    showWarning(`æ¸©åº¦è¿‡é«˜ï¼Œ${cropName}å¯èƒ½å‘ç”Ÿçƒ­å®³ï¼`);
  } else {
    tempAdvice = `å½“å‰æ¸©åº¦${temp.toFixed(2)}Â°Cå¤„äº${cropName}é€‚å®œèŒƒå›´ã€‚å»ºè®®ï¼šä¿æŒç°çŠ¶ï¼Œå®šæœŸç›‘æµ‹ã€‚`;
  }
  document.getElementById('temp-advice').textContent = tempAdvice;
  
  // æ°´åˆ†å»ºè®® - ç¡®ä¿æ˜¾ç¤ºä¸¤ä½å°æ•°
  let waterAdvice = '';
  if (soilMoisture < cropData.optimalSoilMoisture.min) {
    waterAdvice = `åœŸå£¤æ¹¿åº¦${soilMoisture.toFixed(2)}%åä½ï¼Œ${cropName}å¯èƒ½ç¼ºæ°´ã€‚å»ºè®®ï¼šç«‹å³æµ‡æ°´10-15mmï¼Œä¿æŒåœŸå£¤æ¹¿æ¶¦ã€‚`;
    showWarning(`åœŸå£¤æ¹¿åº¦ä¸è¶³ï¼Œ${cropName}éœ€è¦æµ‡æ°´ï¼`);
  } else if (soilMoisture > cropData.optimalSoilMoisture.max) {
    waterAdvice = `åœŸå£¤æ¹¿åº¦è¿‡é«˜(${soilMoisture.toFixed(2)}%)ï¼Œå¯èƒ½å¯¼è‡´æ ¹ç³»è…çƒ‚ã€‚å»ºè®®ï¼šåœæ­¢æµ‡æ°´ï¼ŒåŠ å¼ºé€šé£ï¼Œæ¾åœŸæ’æ°´ã€‚`;
    showWarning(`åœŸå£¤æ¹¿åº¦è¿‡é«˜ï¼Œæ³¨æ„é¢„é˜²æ ¹è…ç—…ï¼`);
  } else {
    waterAdvice = `åœŸå£¤æ¹¿åº¦é€‚å®œ(${soilMoisture.toFixed(2)}%)ã€‚å»ºè®®ï¼šæ ¹æ®å¤©æ°”æƒ…å†µï¼Œæ¯2-3å¤©æµ‡æ°´ä¸€æ¬¡ã€‚`;
  }
  document.getElementById('water-advice').textContent = waterAdvice;
  
  // å…‰ç…§å»ºè®®
  let lightAdvice = '';
  const lightKlx = (light / 1000).toFixed(2);
  if (light < cropData.optimalLight.min) {
    lightAdvice = `å½“å‰å…‰ç…§${lightKlx}åƒlxä¸è¶³ï¼Œ${cropName}å¯èƒ½ç”Ÿé•¿ç¼“æ…¢ã€‚å»ºè®®ï¼šæ¸…ç†æ£šè†œç°å°˜ï¼Œä½¿ç”¨è¡¥å…‰ç¯ï¼Œè°ƒæ•´ç§æ¤å¯†åº¦ã€‚`;
  } else if (light > cropData.optimalLight.max) {
    lightAdvice = `å…‰ç…§è¿‡å¼º(${lightKlx}åƒlx)ï¼Œå¯èƒ½å¯¼è‡´${cropName}å¶ç‰‡ç¼ä¼¤ã€‚å»ºè®®ï¼šä½¿ç”¨é®é˜³ç½‘ï¼Œè°ƒæ•´é€å…‰ç‡ã€‚`;
  } else {
    lightAdvice = `å…‰ç…§å¼ºåº¦${lightKlx}åƒlxé€‚å®œã€‚å»ºè®®ï¼šä¿æŒç°çŠ¶ï¼Œç¡®ä¿æ¯å¤©å…‰ç…§8-10å°æ—¶ã€‚`;
  }
  document.getElementById('light-advice').textContent = lightAdvice;
  
  // æ–½è‚¥ä¸ç—…è™«å®³å»ºè®®
  let fertilizerAdvice = '';
  switch(currentGrowthStage) {
    case 'seedling':
      fertilizerAdvice = `å½“å‰ä¸º${cropName}è‚²è‹—æœŸã€‚å»ºè®®ï¼šæ–½ç”¨æ°®ç£·é’¾å¹³è¡¡è‚¥(20-20-20)ï¼Œæ¯å‘¨ä¸€æ¬¡ï¼Œé¢„é˜²çŒå€’ç—…å’Œç«‹æ¯ç—…ã€‚`;
      break;
    case 'vegetative':
      fertilizerAdvice = `å½“å‰ä¸º${cropName}ç”Ÿé•¿æœŸã€‚å»ºè®®ï¼šå¢åŠ æ°®è‚¥æ¯”ä¾‹ï¼Œä¿ƒè¿›å¶ç‰‡ç”Ÿé•¿ï¼Œé¢„é˜²ç™½ç²‰ç—…å’Œèšœè™«ã€‚`;
      break;
    case 'flowering':
      fertilizerAdvice = `å½“å‰ä¸º${cropName}å¼€èŠ±æœŸã€‚å»ºè®®ï¼šå¢åŠ ç£·é’¾è‚¥ï¼Œå‡å°‘æ°®è‚¥ï¼Œæé«˜åæœç‡ï¼Œé¢„é˜²ç°éœ‰ç—…ã€‚`;
      break;
    case 'fruiting':
      fertilizerAdvice = `å½“å‰ä¸º${cropName}ç»“æœæœŸã€‚å»ºè®®ï¼šæ–½ç”¨é«˜é’¾è‚¥ï¼Œä¿ƒè¿›æœå®è†¨å¤§ï¼Œé¢„é˜²è„è…ç—…å’Œçº¢èœ˜è››ã€‚`;
      break;
    default:
      fertilizerAdvice = `æ ¹æ®${cropName}ç”Ÿé•¿æƒ…å†µï¼Œå»ºè®®å¹³è¡¡æ–½è‚¥ï¼Œæ³¨æ„é¢„é˜²å¸¸è§ç—…è™«å®³ã€‚`;
  }
  document.getElementById('fertilizer-advice').textContent = fertilizerAdvice;
}

// æ˜¾ç¤ºé¢„è­¦
function showWarning(message) {
  const warningAlert = document.getElementById('warning-alert');
  document.getElementById('warning-message').textContent = message;
  warningAlert.classList.remove('hidden');
}

// ç”Ÿæˆç§æ¤è®¡åˆ’
function generatePlantingSchedule() {
  const scheduleContainer = document.getElementById('planting-schedule');
  if (!scheduleContainer) return;
  
  scheduleContainer.innerHTML = '';
  
  const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
  const today = new Date();
  const currentDay = today.getDay() || 7; // è½¬æ¢ä¸º1-7
  
  // ç§æ¤ä»»åŠ¡å®‰æ’
  const tasks = {
    1: 'æµ‡æ°´æ–½è‚¥',
    3: 'ç—…è™«å®³æ£€æŸ¥',
    5: 'ä¿®å‰ªæ•´æ',
    7: 'ç¯å¢ƒè°ƒæ•´'
  };
  
  days.forEach((day, index) => {
    const dayElement = document.createElement('div');
    dayElement.className = 'planting-day';
    
    const dayNumber = index + 1;
    dayElement.textContent = `å‘¨${day}`;
    
    // æ ‡è®°ä»Šå¤©
    if (dayNumber === currentDay) {
      dayElement.classList.add('today');
      dayElement.innerHTML = `å‘¨${day}<br><span class="text-xs text-primary">ä»Šå¤©</span>`;
    }
    
    // æ·»åŠ ä»»åŠ¡æ ‡è®°
    if (tasks[dayNumber]) {
      dayElement.classList.add('task');
      dayElement.innerHTML += `<br><span class="text-xs text-yellow-600">${tasks[dayNumber]}</span>`;
    }
    
    scheduleContainer.appendChild(dayElement);
  });
}

// åˆ·æ–°ç§æ¤å»ºè®®
function refreshPlantingAdvice() {
  // æ·»åŠ åˆ·æ–°åŠ¨ç”»
  const refreshBtn = event?.target?.closest('button') || document.querySelector('[onclick="refreshPlantingAdvice()"]');
  if (refreshBtn) {
    const icon = refreshBtn.querySelector('i');
    if (icon) {
      icon.classList.add('refresh-animation');
      setTimeout(() => icon.classList.remove('refresh-animation'), 500);
    }
  }
  
  generatePlantingAdvice();
}

// åˆå§‹åŒ–ç§æ¤å»ºè®®æ¨¡å—
function initPlantingAdvice() {
  // åˆå§‹åŒ–ä½œç‰©é€‰æ‹©
  selectCropType('tomato');
  selectGrowthStage('seedling');
  
  // åˆå§‹ç”Ÿæˆå»ºè®®
  setTimeout(generatePlantingAdvice, 1000);
  
  // è®¾ç½®å®šæ—¶æ›´æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
  setInterval(generatePlantingAdvice, 300000);
  
  // ä¿®æ”¹ä¼ æ„Ÿå™¨æ•°æ®æ›´æ–°å‡½æ•°ï¼ŒåŒæ—¶æ›´æ–°ç§æ¤å»ºè®®
  const originalFetchSensorData = fetchSensorData;
  fetchSensorData = function() {
    originalFetchSensorData();
    // å»¶è¿Ÿæ›´æ–°ç§æ¤å»ºè®®ï¼Œç¡®ä¿ä¼ æ„Ÿå™¨æ•°æ®å·²æ›´æ–°
    setTimeout(generatePlantingAdvice, 500);
  };
}
</script>
</body>
</html>
